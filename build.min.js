!function(e){"object"==typeof exports?module.exports=e():"function"==typeof define&&define.amd?define(e):"undefined"!=typeof window?window.bento=e():"undefined"!=typeof global?global.bento=e():"undefined"!=typeof self&&(self.bento=e())}(function(){var define,module,exports;return function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof require=="function"&&require;if(!u&&a)return a(o,!0);if(i)return i(o,!0);throw new Error("Cannot find module '"+o+"'")}var f=n[o]={exports:{}};t[o][0].call(f.exports,function(e){var n=t[o][1][e];return s(n?n:e)},f,f.exports,e,t,n,r)}return n[o].exports}var i=typeof require=="function"&&require;for(var o=0;o<r.length;o++)s(r[o]);return s}({1:[function(require,module,exports){var Class=require("klasse");var Matrix4=require("vecmath").Matrix4;var colorString=require("color-string");var BlendMode=require("./BlendMode");var BaseRenderer=new Class({initialize:function(){this.transform=null;this.projection=null;this.tint={r:255,g:255,b:255};this.alpha=1;this.__blendMode=BlendMode.NORMAL;this.gl=null;this.Image2D=require("./Image2D").bind(this,this)},resize:function(width,height){},setTransform:function(matrix){this.transform=matrix},setProjection:function(matrix){this.projection=matrix},setAlpha:function(a){this.alpha=a},setTint:function(r,g,b){var t=this.tint;if(typeof r==="string"){var rgb=colorString.getRgb(r);t.r=rgb[0];t.g=rgb[1];t.b=rgb[2]}else{t.r=~~r;t.g=~~g;t.b=~~b}},clear:function(x,y,width,height){},fillRect:function(x,y,width,height){},drawRect:function(x,y,width,height){},drawImageTiled:function(image,sx,sy,width,height,xScale,yScale,xOff,yOff){},drawImage:function(image,x,y,width,height,sx,sy,swidth,sheight,rotation,rx,ry){},drawLine:function(x1,y1,x2,y2){}});module.exports=BaseRenderer},{"./BlendMode":2,"./Image2D":3,"color-string":8,klasse:24,vecmath:33}],2:[function(require,module,exports){var BlendMode={};var gl={ONE:1,ONE_MINUS_CONSTANT_ALPHA:32772,ONE_MINUS_CONSTANT_COLOR:32770,ONE_MINUS_DST_ALPHA:773,ONE_MINUS_DST_COLOR:775,ONE_MINUS_SRC_ALPHA:771,ONE_MINUS_SRC_COLOR:769,SRC_ALPHA:770,SRC_ALPHA_SATURATE:776,SRC_COLOR:768,DST_ALPHA:772,DST_COLOR:774};BlendMode.NORMAL={operation:"source-over",src:gl.ONE,dst:gl.ONE_MINUS_SRC_ALPHA};BlendMode.ADD={operation:"lighter",src:gl.ONE,dst:gl.ONE};module.exports=BlendMode},{}],3:[function(require,module,exports){var Class=require("klasse");var Signal=require("signals");var Texture=require("kami").Texture;var Image2D=new Class({initialize:function Image2D(renderer,path,onSuccess,onError){this.renderer=renderer;this.path=null;this.data=null;this.tinting=true;this.tintCache=null;this.tintDirty=true;var width=0,height=0;this.source=null;if(typeof path==="string"){this.path=path}else if(typeof arguments[1]==="number"&&typeof arguments[2]==="number"){width=arguments[1];height=arguments[2];var data=arguments[3];if(data){if(data.length!==width*height*4)throw new Error("data must be an array type with length [width * height * 4]");this.data=data}onSuccess=arguments[4];onError=arguments[5]}else if(typeof path==="object"){this.source=path;if(typeof onSuccess==="function")onSuccess()}if(!this.source)this.create(width,height,onSuccess,onError)},width:{get:function(){return this.source.width}},height:{get:function(){return this.source.height}},__onLoad:function(onSuccess){this.tintDirty=true;if(typeof onSuccess==="function")onSuccess()},create:function(width,height,onSuccess,onError){var webgl=!!this.renderer.gl;if(webgl){var context=this.renderer.context;if(this.path){this.source=new Texture(context,this.path,onSuccess,onError)}else{this.source=new Texture(context,width,height,Texture.Format.RGBA,Texture.DataType.UNSIGNED_BYTE,new Uint8Array(this.data));if(typeof onSuccess==="function")onSuccess()}}else{if(this.path){this.source=new Image;this.source.onload=this.__onLoad.bind(this,onSuccess);this.source.onabort=onError;this.source.onerror=onError;this.source.src=this.path}else{var canvas=document.createElement("canvas");canvas.width=width;canvas.height=height;var ctx=canvas.getContext("2d");var imgData=ctx.createImageData(width,height);var pixels=imgData.data;if(typeof Uint8ClampedArray!=="undefined"&&pixels instanceof Uint8ClampedArray){var uint=new Uint8ClampedArray(this.data);pixels.set(uint)}else{var d=this.data;for(var i=0;i<pixels.length;i++){pixels[i]=d[i]}}ctx.putImageData(imgData,0,0);this.tintDirty=true;this.source=canvas;if(typeof onSuccess==="function")onSuccess()}}}});module.exports=Image2D},{kami:20,klasse:24,signals:25}],4:[function(require,module,exports){var Class=require("klasse");var BaseRenderer=require("../BaseRenderer");var colorString=require("color-string");var TintCache=require("./TintCache");var drawTintedImage=require("./tint").drawTintedImage;var Image2D=require("../Image2D");var CanvasRenderer=new Class({Mixins:BaseRenderer,initialize:function CanvasRenderer(width,height,view){BaseRenderer.call(this);this.view=view||document.createElement("canvas");this.width=this.view.width=width||300;this.height=this.view.height=height||150;this.context=this.view.getContext("2d");this.currentContext=this.context;this.__lastTint=null;this.__lastAlpha=null;this.__lastFillStyle=null;this.__lastStrokeStyle=null;this.tinting=true;this.tintCaching=true;this.buffer=null;this.bufferContext=null},blendMode:{get:function(){return this.__blendMode},set:function(val){if(!val||!val.operation)throw new Error("invalid blend mode; doesn't contain 'operation' value for canvas");this.__blendMode=val;this.currentContext.globalCompositeOperation=val.operation}},flush:function(){this.__updateColors(true,true);this.currentContext.globalCompositeOperation=this.blendMode.operation},setTint:function(r,g,b){BaseRenderer.prototype.setTint.call(this,r,g,b);this.__updateColors(true,true)},setAlpha:function(a){BaseRenderer.prototype.setAlpha.call(this,a);this.__updateColors(false,false)},resize:function(width,height){this.width=width;this.height=height;this.view.width=width;this.view.height=height},clear:function(x,y,width,height){x=x||0;y=y||0;width=width===0||width?width:this.width;height=height===0||height?height:this.height;this.currentContext.clearRect(x,y,width,height)},__updateColors:function(fill,stroke){var lt=this.__lastTint,t=this.tint,la=this.__lastAlpha,a=this.alpha,ctx=this.currentContext;if(la!==0&&!la||a!==la){ctx.globalAlpha=a;this.__lastAlpha=a}if(!fill&&!stroke)return;if(!lt||lt.r!==t.r||lt.g!==t.g||lt.b!==t.b){var str=colorString.rgbString([~~t.r,~~t.g,~~t.b]);if(fill)ctx.fillStyle=this.__lastFillStyle=str;if(stroke)ctx.strokeStyle=this.__lastStrokeStyle=str;if(!lt)lt={r:t.r,g:t.g,b:t.b};else{lt.r=t.r;lt.g=t.g;lt.b=t.b}}},fillRect:function(x,y,width,height){this.__updateColors(true,false);this.currentContext.fillRect(x,y,width,height)},drawRect:function(x,y,width,height){this.__updateColors(false,true);this.currentContext.strokeRect(x,y,width,height)},__tint:function(image){if(this.buffer===null){this.buffer=document.createElement("canvas");this.bufferContext=this.buffer.getContext("2d")}var width=image.width,height=image.height;this.buffer.width=width;this.buffer.height=height;this.__updateColors(true,false);var bctx=this.bufferContext;bctx.fillStyle=this.__lastFillStyle;bctx.fillRect(0,0,width,height);bctx.globalCompositeOperation="destination-atop";bctx.drawImage(image,0,0)},drawImage:function(image,x,y,width,height){var src=image.source,ctx=this.currentContext;if(!src)return;x=x||0;y=y||0;width=width===0||width?width:src.width;height=height===0||height?height:src.height;var tint=this.tint,r=~~tint.r,g=~~tint.g,b=~~tint.b;this.__updateColors(true,false);if(this.tinting&&image.tinting&&(r!==255||g!==255||b!==255)){if(!this.tintCaching){drawTintedImage(ctx,src,this.__lastFillStyle,x,y,width,height);return}if(!image.tintCache)image.tintCache=new TintCache(image);src=image.tintCache.tinted(r,g,b,this.__lastFillStyle)}ctx.drawImage(src,x,y,width,height)}});module.exports=CanvasRenderer},{"../BaseRenderer":1,"../Image2D":3,"./TintCache":5,"./tint":6,"color-string":8,klasse:24}],5:[function(require,module,exports){var Class=require("klasse");var createTintedCanvas=require("./tint").createTintedCanvas;var Image2D=require("../Image2D");var ImageBuffer=require("imagebuffer");var colorString=require("color-string");var tint=require("./tint").tint;var TintCache=new Class({initialize:function(image,maxTints){if(!image)throw new Error("TintCache must be tied to a single Image2D");this.image=image;var maxTints=maxTints||TintCache.DEFAULT_MAX_TINTS;this.tints=new Array(maxTints);this.descriptors=new Array(maxTints);this.fuzziness=TintCache.DEFAULT_FUZZINESS||0;this.pointer=0;this.__usePixelData=!TintCache.DEFAULT_COMPOSITING;this.canvas=this.__usePixelData?document.createElement("canvas"):null;this.context=this.__usePixelData?this.canvas.getContext("2d"):null;this.buffer=null},tinted:function(r,g,b,fillStyle){var src=this.image.source;var i=-1;var usePixelData=this.__usePixelData;if(usePixelData&&(this.image.tintDirty||!this.buffer)){var canvas=this.canvas,ctx=this.context;var w=src.width,h=src.height;canvas.width=w;canvas.height=h;ctx.clearRect(0,0,w,h);ctx.drawImage(src,0,0);var imageData=ctx.getImageData(0,0,w,h);this.buffer=new ImageBuffer(imageData)}else{i=this.indexOf(r,g,b)}if(this.image.tintDirty){this.reset();this.image.tintDirty=false}var ret=i!==-1?this.descriptors[i]:null;if(!ret){if(this.pointer>this.tints.length-1)this.pointer=0;var width=src.width,height=src.height;var descriptor=this.descriptors[this.pointer];var otherBuffer=null;if(descriptor){if(descriptor.width!==width||descriptor.height!==height){if(usePixelData){var tmpImageData=descriptor.context.createImageData(width,height);descriptor.buffer=new ImageBuffer(tmpImageData)}descriptor.canvas.width=width;descriptor.canvas.height=height;descriptor.width=width;descriptor.height=height}otherBuffer=descriptor.buffer}else{var dcanvas=document.createElement("canvas");var dcontext=dcanvas.getContext("2d");if(usePixelData){var dImgData=dcontext.createImageData(width,height);otherBuffer=new ImageBuffer(dImgData)}dcanvas.width=width;dcanvas.height=height;descriptor={width:width,height:height,canvas:dcanvas,context:dcontext,buffer:otherBuffer};this.descriptors[this.pointer]=descriptor}if(usePixelData){ImageBuffer.multiply(this.buffer,otherBuffer,r,g,b,255);descriptor.context.putImageData(otherBuffer.imageData,0,0)}else{if(!fillStyle)fillStyle=colorString.rgbString([~~r,~~g,~~b]);tint(descriptor.context,src,fillStyle,0,0,width,height)}this.tints[this.pointer]=r<<16|g<<8|b;this.pointer++;return descriptor.canvas}else{return this.descriptors[i].canvas}},reset:function(){for(var i=0;i<this.tints.length;i++){this.tints[i]=TintCache.NONE}this.pointer=0},indexOf:function(r,g,b){var fuzz=this.fuzziness;if(fuzz===0){var hex=r<<16|g<<8|b;return this.tints.indexOf(hex)}else{for(var i=0;i<this.tints.length;i++){var rgb=this.tints[i];if(rgb===TintCache.NONE)continue;var r2=(rgb&16711680)>>>16;g2=(rgb&65280)>>>8;b2=rgb&255;if(Math.abs(r2-r)<=fuzz&&Math.abs(g2-g)<=fuzz&&Math.abs(b2-b)<=fuzz){return i}}}return-1},remove:function(r,g,b){var i=this.indexOf(r,g,b);if(i===-1)return null;var old=this.descriptors[i].canvas;this.tints[i]=TintCache.NONE;return old},clear:function(){for(var i=0;i<this.tints.length;i++){this.tints[i]=TintCache.NONE;this.descriptors[i]=null}this.pointer=0},countActiveTints:function(){var count=0;for(var i=0;i<this.tints.length;i++)if(this.descriptors[i])count++;return count}});TintCache.DEFAULT_MAX_TINTS=15;TintCache.DEFAULT_FUZZINESS=0;TintCache.DEFAULT_COMPOSITING=true;TintCache.NONE=4294967295;module.exports=TintCache},{"../Image2D":3,"./tint":6,"color-string":8,imagebuffer:11,klasse:24}],6:[function(require,module,exports){var ImageBuffer=require("imagebuffer");var buffer=null,bufferContext=null;function tint(context,image,fillStyle,x,y,width,height){context.fillStyle=fillStyle;context.fillRect(0,0,width,height);context.globalCompositeOperation="multiply";context.drawImage(image,0,0,width,height);context.globalCompositeOperation="destination-in";context.drawImage(image,0,0,width,height)}function drawTintedImage(context,image,fillStyle,x,y,width,height){if(!buffer){buffer=document.createElement("canvas");bufferContext=buffer.getContext("2d")}var srcwidth=image.width,srcheight=image.height;buffer.width=width;buffer.height=height;tint(bufferContext,image,fillStyle,x,y,width,height);context.drawImage(buffer,x,y,width,height)}module.exports={tint:tint,drawTintedImage:drawTintedImage}},{imagebuffer:11}],7:[function(require,module,exports){module.exports={CanvasRenderer:require("./canvas/CanvasRenderer"),BlendMode:require("./BlendMode"),Image2D:require("./Image2D"),TintCache:require("./canvas/TintCache"),tint:require("./canvas/tint")}},{"./BlendMode":2,"./Image2D":3,"./canvas/CanvasRenderer":4,"./canvas/TintCache":5,"./canvas/tint":6}],8:[function(require,module,exports){var convert=require("color-convert");module.exports={getRgba:getRgba,getHsla:getHsla,getRgb:getRgb,getHsl:getHsl,getAlpha:getAlpha,hexString:hexString,rgbString:rgbString,rgbaString:rgbaString,percentString:percentString,percentaString:percentaString,hslString:hslString,hslaString:hslaString,keyword:keyword};function getRgba(string){if(!string){return}var abbr=/^#([a-fA-F0-9]{3})$/,hex=/^#([a-fA-F0-9]{6})$/,rgba=/^rgba?\(\s*(\d+)\s*,\s*(\d+)\s*,\s*(\d+)\s*(?:,\s*([\d\.]+)\s*)?\)$/,per=/^rgba?\(\s*([\d\.]+)\%\s*,\s*([\d\.]+)\%\s*,\s*([\d\.]+)\%\s*(?:,\s*([\d\.]+)\s*)?\)$/,keyword=/(\D+)/;var rgb=[0,0,0],a=1,match=string.match(abbr);if(match){match=match[1];for(var i=0;i<rgb.length;i++){rgb[i]=parseInt(match[i]+match[i],16)}}else if(match=string.match(hex)){match=match[1];for(var i=0;i<rgb.length;i++){rgb[i]=parseInt(match.slice(i*2,i*2+2),16)}}else if(match=string.match(rgba)){for(var i=0;i<rgb.length;i++){rgb[i]=parseInt(match[i+1])}a=parseFloat(match[4])}else if(match=string.match(per)){for(var i=0;i<rgb.length;i++){rgb[i]=Math.round(parseFloat(match[i+1])*2.55)}a=parseFloat(match[4])}else if(match=string.match(keyword)){if(match[1]=="transparent"){return[0,0,0,0]}rgb=convert.keyword2rgb(match[1]);if(!rgb){return}}for(var i=0;i<rgb.length;i++){rgb[i]=scale(rgb[i],0,255)}if(!a&&a!=0){a=1}else{a=scale(a,0,1)}rgb.push(a);return rgb}function getHsla(string){if(!string){return}var hsl=/^hsla?\(\s*(\d+)\s*,\s*([\d\.]+)%\s*,\s*([\d\.]+)%\s*(?:,\s*([\d\.]+)\s*)?\)/;var match=string.match(hsl);if(match){var h=scale(parseInt(match[1]),0,360),s=scale(parseFloat(match[2]),0,100),l=scale(parseFloat(match[3]),0,100),a=scale(parseFloat(match[4])||1,0,1);return[h,s,l,a]}}function getRgb(string){return getRgba(string).slice(0,3)}function getHsl(string){return getHsla(string).slice(0,3)}function getAlpha(string){var vals=getRgba(string);if(vals){return vals[3]}else if(vals=getHsla(string)){return vals[3]}}function hexString(rgb){return"#"+hexDouble(rgb[0])+hexDouble(rgb[1])+hexDouble(rgb[2])}function rgbString(rgba,alpha){if(alpha<1||rgba[3]&&rgba[3]<1){return rgbaString(rgba,alpha)}return"rgb("+rgba[0]+", "+rgba[1]+", "+rgba[2]+")"}function rgbaString(rgba,alpha){if(alpha===undefined){alpha=rgba[3]!==undefined?rgba[3]:1}return"rgba("+rgba[0]+", "+rgba[1]+", "+rgba[2]+", "+alpha+")"}function percentString(rgba,alpha){if(alpha<1||rgba[3]&&rgba[3]<1){return percentaString(rgba,alpha)}var r=Math.round(rgba[0]/255*100),g=Math.round(rgba[1]/255*100),b=Math.round(rgba[2]/255*100);return"rgb("+r+"%, "+g+"%, "+b+"%)"}function percentaString(rgba,alpha){var r=Math.round(rgba[0]/255*100),g=Math.round(rgba[1]/255*100),b=Math.round(rgba[2]/255*100);return"rgba("+r+"%, "+g+"%, "+b+"%, "+(alpha||rgba[3]||1)+")"}function hslString(hsla,alpha){if(alpha<1||hsla[3]&&hsla[3]<1){return hslaString(hsla,alpha)}return"hsl("+hsla[0]+", "+hsla[1]+"%, "+hsla[2]+"%)"}function hslaString(hsla,alpha){return"hsla("+hsla[0]+", "+hsla[1]+"%, "+hsla[2]+"%, "+(alpha||hsla[3]||1)+")"}function keyword(rgb){return convert.rgb2keyword(rgb.slice(0,3))}function scale(num,min,max){return Math.min(Math.max(min,num),max)}function hexDouble(num){var str=num.toString(16).toUpperCase();return str.length<2?"0"+str:str}},{"color-convert":10}],9:[function(require,module,exports){module.exports={rgb2hsl:rgb2hsl,rgb2hsv:rgb2hsv,rgb2cmyk:rgb2cmyk,rgb2keyword:rgb2keyword,rgb2xyz:rgb2xyz,rgb2lab:rgb2lab,hsl2rgb:hsl2rgb,hsl2hsv:hsl2hsv,hsl2cmyk:hsl2cmyk,hsl2keyword:hsl2keyword,hsv2rgb:hsv2rgb,hsv2hsl:hsv2hsl,hsv2cmyk:hsv2cmyk,hsv2keyword:hsv2keyword,cmyk2rgb:cmyk2rgb,cmyk2hsl:cmyk2hsl,cmyk2hsv:cmyk2hsv,cmyk2keyword:cmyk2keyword,keyword2rgb:keyword2rgb,keyword2hsl:keyword2hsl,keyword2hsv:keyword2hsv,keyword2cmyk:keyword2cmyk,xyz2rgb:xyz2rgb};function rgb2hsl(rgb){var r=rgb[0]/255,g=rgb[1]/255,b=rgb[2]/255,min=Math.min(r,g,b),max=Math.max(r,g,b),delta=max-min,h,s,l;if(max==min)h=0;else if(r==max)h=(g-b)/delta;else if(g==max)h=2+(b-r)/delta;else if(b==max)h=4+(r-g)/delta;h=Math.min(h*60,360);if(h<0)h+=360;l=(min+max)/2;if(max==min)s=0;else if(l<=.5)s=delta/(max+min);else s=delta/(2-max-min);return[h,s*100,l*100]}function rgb2hsv(rgb){var r=rgb[0],g=rgb[1],b=rgb[2],min=Math.min(r,g,b),max=Math.max(r,g,b),delta=max-min,h,s,v;if(max==0)s=0;else s=delta/max*1e3/10;if(max==min)h=0;else if(r==max)h=(g-b)/delta;else if(g==max)h=2+(b-r)/delta;else if(b==max)h=4+(r-g)/delta;h=Math.min(h*60,360);if(h<0)h+=360;v=max/255*1e3/10;return[h,s,v]}function rgb2cmyk(rgb){var r=rgb[0]/255,g=rgb[1]/255,b=rgb[2]/255,c,m,y,k;k=Math.min(1-r,1-g,1-b);c=(1-r-k)/(1-k);m=(1-g-k)/(1-k);y=(1-b-k)/(1-k);return[c*100,m*100,y*100,k*100]}function rgb2keyword(rgb){return reverseKeywords[JSON.stringify(rgb)]}function rgb2xyz(rgb){var r=rgb[0]/255,g=rgb[1]/255,b=rgb[2]/255;r=r>.04045?Math.pow((r+.055)/1.055,2.4):r/12.92;g=g>.04045?Math.pow((g+.055)/1.055,2.4):g/12.92;b=b>.04045?Math.pow((b+.055)/1.055,2.4):b/12.92;var x=r*.4124+g*.3576+b*.1805;var y=r*.2126+g*.7152+b*.0722;var z=r*.0193+g*.1192+b*.9505;return[x*100,y*100,z*100]}function rgb2lab(rgb){var xyz=rgb2xyz(rgb),x=xyz[0],y=xyz[1],z=xyz[2],l,a,b;x/=95.047;y/=100;z/=108.883;x=x>.008856?Math.pow(x,1/3):7.787*x+16/116;y=y>.008856?Math.pow(y,1/3):7.787*y+16/116;z=z>.008856?Math.pow(z,1/3):7.787*z+16/116;l=116*y-16;a=500*(x-y);b=200*(y-z);return[l,a,b]}function hsl2rgb(hsl){var h=hsl[0]/360,s=hsl[1]/100,l=hsl[2]/100,t1,t2,t3,rgb,val;if(s==0){val=l*255;return[val,val,val]}if(l<.5)t2=l*(1+s);else t2=l+s-l*s;t1=2*l-t2;rgb=[0,0,0];for(var i=0;i<3;i++){t3=h+1/3*-(i-1);t3<0&&t3++;t3>1&&t3--;if(6*t3<1)val=t1+(t2-t1)*6*t3;else if(2*t3<1)val=t2;else if(3*t3<2)val=t1+(t2-t1)*(2/3-t3)*6;else val=t1;rgb[i]=val*255}return rgb}function hsl2hsv(hsl){var h=hsl[0],s=hsl[1]/100,l=hsl[2]/100,sv,v;l*=2;s*=l<=1?l:2-l;v=(l+s)/2;sv=2*s/(l+s);return[h,s*100,v*100]}function hsl2cmyk(args){return rgb2cmyk(hsl2rgb(args))}function hsl2keyword(args){return rgb2keyword(hsl2rgb(args))}function hsv2rgb(hsv){var h=hsv[0]/60,s=hsv[1]/100,v=hsv[2]/100,hi=Math.floor(h)%6;var f=h-Math.floor(h),p=255*v*(1-s),q=255*v*(1-s*f),t=255*v*(1-s*(1-f)),v=255*v;switch(hi){case 0:return[v,t,p];case 1:return[q,v,p];case 2:return[p,v,t];case 3:return[p,q,v];case 4:return[t,p,v];case 5:return[v,p,q]}}function hsv2hsl(hsv){var h=hsv[0],s=hsv[1]/100,v=hsv[2]/100,sl,l;l=(2-s)*v;sl=s*v;sl/=l<=1?l:2-l;l/=2;return[h,sl*100,l*100]}function hsv2cmyk(args){return rgb2cmyk(hsv2rgb(args))}function hsv2keyword(args){return rgb2keyword(hsv2rgb(args))}function cmyk2rgb(cmyk){var c=cmyk[0]/100,m=cmyk[1]/100,y=cmyk[2]/100,k=cmyk[3]/100,r,g,b;r=1-Math.min(1,c*(1-k)+k);g=1-Math.min(1,m*(1-k)+k);b=1-Math.min(1,y*(1-k)+k);return[r*255,g*255,b*255]}function cmyk2hsl(args){return rgb2hsl(cmyk2rgb(args))}function cmyk2hsv(args){return rgb2hsv(cmyk2rgb(args))}function cmyk2keyword(args){return rgb2keyword(cmyk2rgb(args))}function xyz2rgb(xyz){var x=xyz[0]/100,y=xyz[1]/100,z=xyz[2]/100,r,g,b;r=x*3.2406+y*-1.5372+z*-.4986;g=x*-.9689+y*1.8758+z*.0415;b=x*.0557+y*-.204+z*1.057;r=r>.0031308?1.055*Math.pow(r,1/2.4)-.055:r=r*12.92;g=g>.0031308?1.055*Math.pow(g,1/2.4)-.055:g=g*12.92;b=b>.0031308?1.055*Math.pow(b,1/2.4)-.055:b=b*12.92;r=r<0?0:r;g=g<0?0:g;b=b<0?0:b;return[r*255,g*255,b*255]}function keyword2rgb(keyword){return cssKeywords[keyword]}function keyword2hsl(args){return rgb2hsl(keyword2rgb(args))}function keyword2hsv(args){return rgb2hsv(keyword2rgb(args))}function keyword2cmyk(args){return rgb2cmyk(keyword2rgb(args))}var cssKeywords={aliceblue:[240,248,255],antiquewhite:[250,235,215],aqua:[0,255,255],aquamarine:[127,255,212],azure:[240,255,255],beige:[245,245,220],bisque:[255,228,196],black:[0,0,0],blanchedalmond:[255,235,205],blue:[0,0,255],blueviolet:[138,43,226],brown:[165,42,42],burlywood:[222,184,135],cadetblue:[95,158,160],chartreuse:[127,255,0],chocolate:[210,105,30],coral:[255,127,80],cornflowerblue:[100,149,237],cornsilk:[255,248,220],crimson:[220,20,60],cyan:[0,255,255],darkblue:[0,0,139],darkcyan:[0,139,139],darkgoldenrod:[184,134,11],darkgray:[169,169,169],darkgreen:[0,100,0],darkgrey:[169,169,169],darkkhaki:[189,183,107],darkmagenta:[139,0,139],darkolivegreen:[85,107,47],darkorange:[255,140,0],darkorchid:[153,50,204],darkred:[139,0,0],darksalmon:[233,150,122],darkseagreen:[143,188,143],darkslateblue:[72,61,139],darkslategray:[47,79,79],darkslategrey:[47,79,79],darkturquoise:[0,206,209],darkviolet:[148,0,211],deeppink:[255,20,147],deepskyblue:[0,191,255],dimgray:[105,105,105],dimgrey:[105,105,105],dodgerblue:[30,144,255],firebrick:[178,34,34],floralwhite:[255,250,240],forestgreen:[34,139,34],fuchsia:[255,0,255],gainsboro:[220,220,220],ghostwhite:[248,248,255],gold:[255,215,0],goldenrod:[218,165,32],gray:[128,128,128],green:[0,128,0],greenyellow:[173,255,47],grey:[128,128,128],honeydew:[240,255,240],hotpink:[255,105,180],indianred:[205,92,92],indigo:[75,0,130],ivory:[255,255,240],khaki:[240,230,140],lavender:[230,230,250],lavenderblush:[255,240,245],lawngreen:[124,252,0],lemonchiffon:[255,250,205],lightblue:[173,216,230],lightcoral:[240,128,128],lightcyan:[224,255,255],lightgoldenrodyellow:[250,250,210],lightgray:[211,211,211],lightgreen:[144,238,144],lightgrey:[211,211,211],lightpink:[255,182,193],lightsalmon:[255,160,122],lightseagreen:[32,178,170],lightskyblue:[135,206,250],lightslategray:[119,136,153],lightslategrey:[119,136,153],lightsteelblue:[176,196,222],lightyellow:[255,255,224],lime:[0,255,0],limegreen:[50,205,50],linen:[250,240,230],magenta:[255,0,255],maroon:[128,0,0],mediumaquamarine:[102,205,170],mediumblue:[0,0,205],mediumorchid:[186,85,211],mediumpurple:[147,112,219],mediumseagreen:[60,179,113],mediumslateblue:[123,104,238],mediumspringgreen:[0,250,154],mediumturquoise:[72,209,204],mediumvioletred:[199,21,133],midnightblue:[25,25,112],mintcream:[245,255,250],mistyrose:[255,228,225],moccasin:[255,228,181],navajowhite:[255,222,173],navy:[0,0,128],oldlace:[253,245,230],olive:[128,128,0],olivedrab:[107,142,35],orange:[255,165,0],orangered:[255,69,0],orchid:[218,112,214],palegoldenrod:[238,232,170],palegreen:[152,251,152],paleturquoise:[175,238,238],palevioletred:[219,112,147],papayawhip:[255,239,213],peachpuff:[255,218,185],peru:[205,133,63],pink:[255,192,203],plum:[221,160,221],powderblue:[176,224,230],purple:[128,0,128],red:[255,0,0],rosybrown:[188,143,143],royalblue:[65,105,225],saddlebrown:[139,69,19],salmon:[250,128,114],sandybrown:[244,164,96],seagreen:[46,139,87],seashell:[255,245,238],sienna:[160,82,45],silver:[192,192,192],skyblue:[135,206,235],slateblue:[106,90,205],slategray:[112,128,144],slategrey:[112,128,144],snow:[255,250,250],springgreen:[0,255,127],steelblue:[70,130,180],tan:[210,180,140],teal:[0,128,128],thistle:[216,191,216],tomato:[255,99,71],turquoise:[64,224,208],violet:[238,130,238],wheat:[245,222,179],white:[255,255,255],whitesmoke:[245,245,245],yellow:[255,255,0],yellowgreen:[154,205,50]};var reverseKeywords={};for(var key in cssKeywords){reverseKeywords[JSON.stringify(cssKeywords[key])]=key}},{}],10:[function(require,module,exports){var conversions=require("./conversions");var exports={};module.exports=exports;for(var func in conversions){exports[func+"Raw"]=function(func){return function(arg){if(typeof arg=="number")arg=Array.prototype.slice.call(arguments);return conversions[func](arg)}}(func);var pair=/(\w+)2(\w+)/.exec(func),from=pair[1],to=pair[2];exports[from]=exports[from]||{};exports[from][to]=exports[func]=function(func){return function(arg){if(typeof arg=="number")arg=Array.prototype.slice.call(arguments);var val=conversions[func](arg);if(typeof val=="string"||val===undefined)return val;for(var i=0;i<val.length;i++)val[i]=Math.round(val[i]);return val}}(func)}},{"./conversions":9}],11:[function(require,module,exports){function isLittleEndian(){var a=new ArrayBuffer(4);var b=new Uint8Array(a);var c=new Uint32Array(a);b[0]=161;b[1]=178;b[2]=195;b[3]=212;if(c[0]==3569595041)return true;if(c[0]==2712847316)return false;else{return null}}function isUint8ClampedImageData(){if(typeof Uint8ClampedArray==="undefined")return false;var elem=document.createElement("canvas");var ctx=elem.getContext("2d");if(!ctx)return false;var image=ctx.createImageData(1,1);return image.data instanceof Uint8ClampedArray}var LITTLE_ENDIAN=isLittleEndian();var SUPPORTS_32BIT=typeof ArrayBuffer!=="undefined"&&typeof Uint8ClampedArray!=="undefined"&&typeof Int32Array!=="undefined"&&LITTLE_ENDIAN!==null&&isUint8ClampedImageData();var ImageBuffer=function(width,height){this.imageData=null;if(typeof width!=="number"){this.imageData=width;width=this.imageData.width;height=this.imageData.height}this.width=width;this.height=height;this.pixels=null;this.direct=false;this.uint8=null;if(this.imageData){this.direct=true;if(SUPPORTS_32BIT){this.uint8=this.imageData.data;this.pixels=new Int32Array(this.uint8.buffer)}else{this.pixels=this.uint8=this.imageData.data}}else{if(SUPPORTS_32BIT){this.uint8=new Uint8ClampedArray(width*height*ImageBuffer.NUM_COMPONENTS);this.pixels=new Int32Array(this.uint8.buffer)}else{this.pixels=this.uint8=new Array(width*height*ImageBuffer.NUM_COMPONENTS)}}};ImageBuffer.prototype.constructor=ImageBuffer;ImageBuffer.prototype.setPixelAt=function(x,y,r,g,b,a){var i=~~(x+y*this.width);this.setPixel(i,r,g,b,a)};ImageBuffer.prototype.getPixelAt=function(x,y,out){var i=~~(x+y*this.width);return this.getPixel(i,out)};ImageBuffer.prototype.createImage=function(context){var canvas;if(!context){canvas=document.createElement("canvas");context=canvas.getContext("2d")}else{canvas=context.canvas}if(typeof canvas.toDataURL!=="function")throw new Error("Canvas.toDataURL is not supported");canvas.width=this.width;canvas.height=this.height;var imageData=this.imageData;if(!this.direct||!this.imageData){imageData=context.createImageData(this.width,this.height);this.apply(imageData)}context.clearRect(0,0,this.width,this.height);context.putImageData(imageData,0,0);var img=new Image;img.src=canvas.toDataURL.apply(canvas,Array.prototype.slice.call(arguments,1));imageData=null;context=null;canvas=null;return img};ImageBuffer.prototype.apply=function(imageData){if(this.imageData===imageData&&this.direct){return}if(SUPPORTS_32BIT){if(imageData instanceof ImageBuffer){imageData.pixels.set(this.pixels)}else{imageData.data.set(this.uint8)}}else{var data=imageData instanceof ImageBuffer?imageData.pixels:imageData.data;if(!data)throw new Error("imageData must be an ImageBuffer or Canvas ImageData object");var pixels=this.pixels;if(data.length!==pixels.length)throw new Error("the image data for apply() must have the same dimensions");for(var i=0;i<pixels.length;i++){data[i]=pixels[i]}}};ImageBuffer.NUM_COMPONENTS=4;ImageBuffer.SUPPORTS_32BIT=SUPPORTS_32BIT;ImageBuffer.LITTLE_ENDIAN=LITTLE_ENDIAN;if(SUPPORTS_32BIT){if(LITTLE_ENDIAN){ImageBuffer.prototype.setPixel=function(index,r,g,b,a){this.pixels[index]=a<<24|b<<16|g<<8|r};ImageBuffer.multiply=function(inputBuffer,outputBuffer,r,g,b,a){var rgba=a<<24|b<<16|g<<8|r;var input=inputBuffer.pixels,output=outputBuffer.pixels,len=input.length,a1,a2,b1,b2,g1,g2,r1,r2,val;for(var i=0;i<len;i++){val1=input[i];a1=(val1&4278190080)>>>24;a2=(rgba&4278190080)>>>24;b1=(val1&16711680)>>>16;b2=(rgba&16711680)>>>16;g1=(val1&65280)>>>8;g2=(rgba&65280)>>>8;r1=val1&255;r2=rgba&255;r=r1*r2/255;g=g1*g2/255;b=b1*b2/255;a=a1*a2/255;output[i]=a<<24|b<<16|g<<8|r}}}else{ImageBuffer.prototype.setPixel=function(index,r,g,b,a){this.pixels[index]=r<<24|g<<16|b<<8|a};ImageBuffer.multiply=function(inputBuffer,outputBuffer,r,g,b,a){var rgba=r<<24|g<<16|b<<8|a;var input=inputBuffer.pixels,output=outputBuffer.pixels,len=input.length,a1,a2,b1,b2,g1,g2,r1,r2,val1;for(var i=0;i<len;i++){val1=input[i];r1=(val1&4278190080)>>>24;r2=(rgba&4278190080)>>>24;g1=(val1&16711680)>>>16;g2=(rgba&16711680)>>>16;b1=(val1&65280)>>>8;b2=(rgba&65280)>>>8;a1=val1&255;a2=rgba&255;r=r1*r2/255;g=g1*g2/255;b=b1*b2/255;a=a1*a2/255;output[i]=r<<24|g<<16|b<<8|a}}}}else{ImageBuffer.prototype.setPixel=function(index,r,g,b,a){var pixels=this.pixels;index*=4;pixels[index]=r;pixels[++index]=g;pixels[++index]=b;pixels[++index]=a};ImageBuffer.prototype.multiply=function(inputBuffer,outputBuffer,r,g,b,a){var input=inputBuffer.pixels,output=outputBuffer.pixels,len=input.length;for(var i=0;i<len;i+=4){output[i]=input[i]*r/255;output[i+1]=input[i+1]*g/255;output[i+2]=input[i+2]*b/255;output[i+3]=input[i+3]*a/255}}}ImageBuffer.prototype.getPixel=function(index,out){var pixels=this.uint8;index*=4;if(!out)out={r:0,g:0,b:0,a:0};out.r=pixels[index];out.g=pixels[++index];out.b=pixels[++index];out.a=pixels[++index];return out};if(LITTLE_ENDIAN){ImageBuffer.packPixel=function(r,g,b,a){return a<<24|b<<16|g<<8|r};ImageBuffer.unpackPixel=function(rgba,out){if(!out)out={r:0,g:0,b:0,a:0};out.a=(rgba&4278190080)>>>24;out.b=(rgba&16711680)>>>16;out.g=(rgba&65280)>>>8;out.r=rgba&255;return out}}else{ImageBuffer.packPixel=function(r,g,b,a){return r<<24|g<<16|b<<8|a};ImageBuffer.unpackPixel=function(rgba,out){if(!out)out={r:0,g:0,b:0,a:0};out.r=(rgba&4278190080)>>>24;out.g=(rgba&16711680)>>>16;out.b=(rgba&65280)>>>8;out.a=rgba&255;return out}}ImageBuffer.fromRGBA=function(rgba,out){if(!out)out={r:0,g:0,b:0,a:0};out.r=(rgba&4278190080)>>>24;out.g=(rgba&16711680)>>>16;out.b=(rgba&65280)>>>8;out.a=rgba&255;return out};ImageBuffer.toRGBA=function(r,g,b,a){return r<<24|g<<16|b<<8|a};ImageBuffer.createColor=function(r,g,b,a){return{r:r||0,g:g||0,b:b||0,a:a||0}};module.exports=ImageBuffer},{}],12:[function(require,module,exports){var Class=require("klasse");var Mesh=require("./glutils/Mesh");var colorToFloat=require("number-util").colorToFloat;var BaseBatch=new Class({initialize:function BaseBatch(context,size){if(typeof context!=="object")throw"GL context not specified to SpriteBatch";this.context=context;this.size=size||500;if(this.size>10922)throw"Can't have more than 10922 sprites per batch: "+this.size;this._blendSrc=this.context.gl.ONE;this._blendDst=this.context.gl.ONE_MINUS_SRC_ALPHA;this._blendingEnabled=true;this._shader=this._createShader();this.defaultShader=this._shader;this.ownsShader=true;this.idx=0;this.drawing=false;this.mesh=this._createMesh(this.size);this.color=colorToFloat(255,255,255,255);this.premultiplied=true},blendingEnabled:{set:function(val){var old=this._blendingEnabled;if(this.drawing)this.flush();this._blendingEnabled=val;if(this.drawing&&old!=val){var gl=this.context.gl;if(val)gl.enable(gl.BLEND);else gl.disable(gl.BLEND)}},get:function(){return this._blendingEnabled}},blendSrc:{set:function(val){if(this.drawing)this.flush();this._blendSrc=val},get:function(){return this._blendSrc}},blendDst:{set:function(val){if(this.drawing)this.flush();this._blendDst=val},get:function(){return this._blendDst}},setBlendFunction:function(blendSrc,blendDst){this.blendSrc=blendSrc;this.blendDst=blendDst},shader:{set:function(val){var wasDrawing=this.drawing;if(wasDrawing){this.end()}this._shader=val?val:this.defaultShader;if(wasDrawing){this.begin()}},get:function(){return this._shader}},setColor:function(r,g,b,a){var rnum=typeof r==="number";if(rnum&&typeof g==="number"&&typeof b==="number"){a=a||a===0?a:1}else{r=g=b=a=rnum?r:1}if(this.premultiplied){r*=a;g*=a;b*=a}this.color=colorToFloat(~~(r*255),~~(g*255),~~(b*255),~~(a*255))},_createMesh:function(size){var numVerts=size*4*this.getVertexSize();
var numIndices=size*6;var gl=this.context.gl;this.vertices=new Float32Array(numVerts);this.indices=new Uint16Array(numIndices);for(var i=0,j=0;i<numIndices;i+=6,j+=4){this.indices[i+0]=j+0;this.indices[i+1]=j+1;this.indices[i+2]=j+2;this.indices[i+3]=j+0;this.indices[i+4]=j+2;this.indices[i+5]=j+3}var mesh=new Mesh(this.context,false,numVerts,numIndices,this._createVertexAttributes());mesh.vertices=this.vertices;mesh.indices=this.indices;mesh.vertexUsage=gl.DYNAMIC_DRAW;mesh.indexUsage=gl.STATIC_DRAW;mesh.dirty=true;return mesh},_createShader:function(){throw"_createShader not implemented"},_createVertexAttributes:function(){throw"_createVertexAttributes not implemented"},getVertexSize:function(){throw"getVertexSize not implemented"},begin:function(){if(this.drawing)throw"batch.end() must be called before begin";this.drawing=true;this.shader.bind();this.mesh.bind(this.shader);if(this._blendingEnabled){var gl=this.context.gl;gl.enable(gl.BLEND)}},end:function(){if(!this.drawing)throw"batch.begin() must be called before end";if(this.idx>0)this.flush();this.drawing=false;this.mesh.unbind(this.shader);if(this._blendEnabled){var gl=this.context.gl;gl.disable(gl.BLEND)}},_preRender:function(){},flush:function(){if(this.idx===0)return;var gl=this.context.gl;if(this._blendEnabled){if(this._blendSrc&&this._blendDst)gl.blendFunc(this._blendSrc,this._blendDst)}this._preRender();var numComponents=this.getVertexSize();var spriteCount=this.idx/(numComponents*4);this.mesh.verticesDirty=true;this.mesh.draw(gl.TRIANGLES,spriteCount*6,0,this.idx);this.idx=0},draw:function(texture,x,y,width,height,u1,v1,u2,v2){},drawVertices:function(texture,verts,off){},drawRegion:function(region,x,y,width,height){this.draw(region.texture,x,y,width,height,region.u,region.v,region.u2,region.v2)},destroy:function(){this.vertices=null;this.indices=null;this.size=this.maxVertices=0;if(this.ownsShader&&this.defaultShader)this.defaultShader.destroy();this.defaultShader=null;this._shader=null;if(this.mesh)this.mesh.destroy();this.mesh=null}});module.exports=BaseBatch},{"./glutils/Mesh":18,klasse:21,"number-util":22}],13:[function(require,module,exports){var Class=require("klasse");var BaseBatch=require("./BaseBatch");var Mesh=require("./glutils/Mesh");var ShaderProgram=require("./glutils/ShaderProgram");var SpriteBatch=new Class({Mixins:BaseBatch,initialize:function SpriteBatch(context,size){BaseBatch.call(this,context,size);this.projection=new Float32Array(2);this.projection[0]=this.context.width/2;this.projection[1]=this.context.height/2;this.texture=null},resize:function(width,height){this.setProjection(width/2,height/2)},getVertexSize:function(){return SpriteBatch.VERTEX_SIZE},_createVertexAttributes:function(){var gl=this.context.gl;return[new Mesh.Attrib(ShaderProgram.POSITION_ATTRIBUTE,2),new Mesh.Attrib(ShaderProgram.COLOR_ATTRIBUTE,4,null,gl.UNSIGNED_BYTE,true,1),new Mesh.Attrib(ShaderProgram.TEXCOORD_ATTRIBUTE+"0",2)]},setProjection:function(x,y){var oldX=this.projection[0];var oldY=this.projection[1];this.projection[0]=x;this.projection[1]=y;if(this.drawing&&(x!=oldX||y!=oldY)){this.flush();this._updateMatrices()}},_createShader:function(){var shader=new ShaderProgram(this.context,SpriteBatch.DEFAULT_VERT_SHADER,SpriteBatch.DEFAULT_FRAG_SHADER);if(shader.log)console.warn("Shader Log:\n"+shader.log);return shader},updateMatrices:function(){this.shader.setUniformfv("u_projection",this.projection)},_preRender:function(){if(this.texture)this.texture.bind()},begin:function(){var gl=this.context.gl;BaseBatch.prototype.begin.call(this);this.updateMatrices();this.shader.setUniformi("u_texture0",0);gl.depthMask(false)},end:function(){var gl=this.context.gl;BaseBatch.prototype.end.call(this);gl.depthMask(true)},flush:function(){if(!this.texture)return;if(this.idx===0)return;BaseBatch.prototype.flush.call(this);SpriteBatch.totalRenderCalls++},draw:function(texture,x,y,width,height,u1,v1,u2,v2){if(!this.drawing)throw"Illegal State: trying to draw a batch before begin()";if(!texture)return;if(this.texture===null||this.texture.id!==texture.id){this.flush();this.texture=texture}else if(this.idx==this.vertices.length){this.flush()}width=width===0?width:width||texture.width;height=height===0?height:height||texture.height;x=x||0;y=y||0;var x1=x;var x2=x+width;var y1=y;var y2=y+height;u1=u1||0;u2=u2===0?u2:u2||1;v1=v1||0;v2=v2===0?v2:v2||1;var c=this.color;this.vertices[this.idx++]=x1;this.vertices[this.idx++]=y1;this.vertices[this.idx++]=c;this.vertices[this.idx++]=u1;this.vertices[this.idx++]=v1;this.vertices[this.idx++]=x2;this.vertices[this.idx++]=y1;this.vertices[this.idx++]=c;this.vertices[this.idx++]=u2;this.vertices[this.idx++]=v1;this.vertices[this.idx++]=x2;this.vertices[this.idx++]=y2;this.vertices[this.idx++]=c;this.vertices[this.idx++]=u2;this.vertices[this.idx++]=v2;this.vertices[this.idx++]=x1;this.vertices[this.idx++]=y2;this.vertices[this.idx++]=c;this.vertices[this.idx++]=u1;this.vertices[this.idx++]=v2},drawVertices:function(texture,verts,off){if(!this.drawing)throw"Illegal State: trying to draw a batch before begin()";if(!texture)return;if(this.texture!=texture){this.flush();this.texture=texture}else if(this.idx==this.vertices.length){this.flush()}off=off||0;this.vertices[this.idx++]=verts[off++];this.vertices[this.idx++]=verts[off++];this.vertices[this.idx++]=verts[off++];this.vertices[this.idx++]=verts[off++];this.vertices[this.idx++]=verts[off++];this.vertices[this.idx++]=verts[off++];this.vertices[this.idx++]=verts[off++];this.vertices[this.idx++]=verts[off++];this.vertices[this.idx++]=verts[off++];this.vertices[this.idx++]=verts[off++];this.vertices[this.idx++]=verts[off++];this.vertices[this.idx++]=verts[off++];this.vertices[this.idx++]=verts[off++];this.vertices[this.idx++]=verts[off++];this.vertices[this.idx++]=verts[off++];this.vertices[this.idx++]=verts[off++];this.vertices[this.idx++]=verts[off++];this.vertices[this.idx++]=verts[off++];this.vertices[this.idx++]=verts[off++];this.vertices[this.idx++]=verts[off++]}});SpriteBatch.VERTEX_SIZE=5;SpriteBatch.totalRenderCalls=0;SpriteBatch.DEFAULT_FRAG_SHADER=["precision mediump float;","varying vec2 vTexCoord0;","varying vec4 vColor;","uniform sampler2D u_texture0;","void main(void) {","   gl_FragColor = texture2D(u_texture0, vTexCoord0) * vColor;","}"].join("\n");SpriteBatch.DEFAULT_VERT_SHADER=["attribute vec2 "+ShaderProgram.POSITION_ATTRIBUTE+";","attribute vec4 "+ShaderProgram.COLOR_ATTRIBUTE+";","attribute vec2 "+ShaderProgram.TEXCOORD_ATTRIBUTE+"0;","uniform vec2 u_projection;","varying vec2 vTexCoord0;","varying vec4 vColor;","void main(void) {","   gl_Position = vec4( "+ShaderProgram.POSITION_ATTRIBUTE+".x / u_projection.x - 1.0, "+ShaderProgram.POSITION_ATTRIBUTE+".y / -u_projection.y + 1.0 , 0.0, 1.0);","   vTexCoord0 = "+ShaderProgram.TEXCOORD_ATTRIBUTE+"0;","   vColor = "+ShaderProgram.COLOR_ATTRIBUTE+";","}"].join("\n");module.exports=SpriteBatch},{"./BaseBatch":12,"./glutils/Mesh":18,"./glutils/ShaderProgram":19,klasse:21}],14:[function(require,module,exports){var Class=require("klasse");var Signal=require("signals");var nextPowerOfTwo=require("number-util").nextPowerOfTwo;var isPowerOfTwo=require("number-util").isPowerOfTwo;var Texture=new Class({initialize:function Texture(context,width,height,format,dataType,data,genMipmaps){if(typeof context!=="object")throw"GL context not specified to Texture";this.context=context;this.id=null;this.target=context.gl.TEXTURE_2D;this.width=0;this.height=0;this.wrapS=Texture.DEFAULT_WRAP;this.wrapT=Texture.DEFAULT_WRAP;this.minFilter=Texture.DEFAULT_FILTER;this.magFilter=Texture.DEFAULT_FILTER;this.managedArgs=Array.prototype.slice.call(arguments,1);this.context.addManagedObject(this);this.create()},setup:function(width,height,format,dataType,data,genMipmaps){var gl=this.gl;if(typeof width==="string"){var img=new Image;var path=arguments[0];var successCB=typeof arguments[1]==="function"?arguments[1]:null;var failCB=typeof arguments[2]==="function"?arguments[2]:null;genMipmaps=!!arguments[3];var self=this;if(Texture.USE_DUMMY_1x1_DATA){self.uploadData(1,1);this.width=this.height=0}img.onload=function(){self.uploadImage(img,undefined,undefined,genMipmaps);if(successCB)successCB()};img.onerror=function(){if(genMipmaps)gl.generateMipmap(gl.TEXTURE_2D);if(failCB)failCB()};img.onabort=function(){if(genMipmaps)gl.generateMipmap(gl.TEXTURE_2D);if(failCB)failCB()};img.src=path}else{this.uploadData(width,height,format,dataType,data,genMipmaps)}},create:function(){this.gl=this.context.gl;var gl=this.gl;this.id=gl.createTexture();this.width=this.height=0;this.target=gl.TEXTURE_2D;this.bind();gl.pixelStorei(gl.UNPACK_PREMULTIPLY_ALPHA_WEBGL,Texture.UNPACK_PREMULTIPLY_ALPHA);gl.pixelStorei(gl.UNPACK_ALIGNMENT,Texture.UNPACK_ALIGNMENT);gl.pixelStorei(gl.UNPACK_FLIP_Y_WEBGL,Texture.UNPACK_FLIP_Y);var colorspace=Texture.UNPACK_COLORSPACE_CONVERSION||gl.BROWSER_DEFAULT_WEBGL;gl.pixelStorei(gl.UNPACK_COLORSPACE_CONVERSION_WEBGL,colorspace);this.setWrap(this.wrapS,this.wrapT,false);this.setFilter(this.minFilter,this.magFilter,false);if(this.managedArgs.length!==0){this.setup.apply(this,this.managedArgs)}},destroy:function(){if(this.id&&this.gl)this.gl.deleteTexture(this.id);if(this.context)this.context.removeManagedObject(this);this.width=this.height=0;this.id=null;this.managedArgs=null;this.context=null;this.gl=null},setWrap:function(s,t,ignoreBind){if(s&&t){this.wrapS=s;this.wrapT=t}else this.wrapS=this.wrapT=s;this._checkPOT();if(!ignoreBind)this.bind();var gl=this.gl;gl.texParameteri(this.target,gl.TEXTURE_WRAP_S,this.wrapS);gl.texParameteri(this.target,gl.TEXTURE_WRAP_T,this.wrapT)},setFilter:function(min,mag,ignoreBind){if(min&&mag){this.minFilter=min;this.magFilter=mag}else this.minFilter=this.magFilter=min;this._checkPOT();if(!ignoreBind)this.bind();var gl=this.gl;gl.texParameteri(this.target,gl.TEXTURE_MIN_FILTER,this.minFilter);gl.texParameteri(this.target,gl.TEXTURE_MAG_FILTER,this.magFilter)},uploadData:function(width,height,format,type,data,genMipmaps){var gl=this.gl;format=format||gl.RGBA;type=type||gl.UNSIGNED_BYTE;data=data||null;this.width=width||width==0?width:this.width;this.height=height||height==0?height:this.height;this._checkPOT();this.bind();gl.texImage2D(this.target,0,format,this.width,this.height,0,format,type,data);if(genMipmaps)gl.generateMipmap(this.target)},uploadImage:function(domObject,format,type,genMipmaps){var gl=this.gl;format=format||gl.RGBA;type=type||gl.UNSIGNED_BYTE;this.width=domObject.width;this.height=domObject.height;this._checkPOT();this.bind();gl.texImage2D(this.target,0,format,format,type,domObject);if(genMipmaps)gl.generateMipmap(this.target)},_checkPOT:function(){if(!Texture.FORCE_POT){var wrongFilter=this.minFilter!==Texture.Filter.LINEAR&&this.minFilter!==Texture.Filter.NEAREST;var wrongWrap=this.wrapS!==Texture.Wrap.CLAMP_TO_EDGE||this.wrapT!==Texture.Wrap.CLAMP_TO_EDGE;if(wrongFilter||wrongWrap){if(!isPowerOfTwo(this.width)||!isPowerOfTwo(this.height))throw new Error(wrongFilter?"Non-power-of-two textures cannot use mipmapping as filter":"Non-power-of-two textures must use CLAMP_TO_EDGE as wrap")}}},bind:function(unit){var gl=this.gl;if(unit||unit===0)gl.activeTexture(gl.TEXTURE0+unit);gl.bindTexture(this.target,this.id)},toString:function(){return this.id+":"+this.width+"x"+this.height+""}});Texture.Filter={NEAREST:9728,NEAREST_MIPMAP_LINEAR:9986,NEAREST_MIPMAP_NEAREST:9984,LINEAR:9729,LINEAR_MIPMAP_LINEAR:9987,LINEAR_MIPMAP_NEAREST:9985};Texture.Wrap={CLAMP_TO_EDGE:33071,MIRRORED_REPEAT:33648,REPEAT:10497};Texture.Format={DEPTH_COMPONENT:6402,ALPHA:6406,RGBA:6408,RGB:6407,LUMINANCE:6409,LUMINANCE_ALPHA:6410};Texture.DataType={BYTE:5120,SHORT:5122,INT:5124,FLOAT:5126,UNSIGNED_BYTE:5121,UNSIGNED_INT:5125,UNSIGNED_SHORT:5123,UNSIGNED_SHORT_4_4_4_4:32819,UNSIGNED_SHORT_5_5_5_1:32820,UNSIGNED_SHORT_5_6_5:33635};Texture.DEFAULT_WRAP=Texture.Wrap.CLAMP_TO_EDGE;Texture.DEFAULT_FILTER=Texture.Filter.NEAREST;Texture.FORCE_POT=false;Texture.UNPACK_FLIP_Y=false;Texture.UNPACK_ALIGNMENT=1;Texture.UNPACK_PREMULTIPLY_ALPHA=true;Texture.UNPACK_COLORSPACE_CONVERSION=undefined;Texture.USE_DUMMY_1x1_DATA=true;Texture.getNumComponents=function(format){switch(format){case Texture.Format.DEPTH_COMPONENT:case Texture.Format.ALPHA:case Texture.Format.LUMINANCE:return 1;case Texture.Format.LUMINANCE_ALPHA:return 2;case Texture.Format.RGB:return 3;case Texture.Format.RGBA:return 4}return null};module.exports=Texture},{klasse:21,"number-util":22,signals:23}],15:[function(require,module,exports){var Class=require("klasse");var Texture=require("./Texture");var TextureRegion=new Class({initialize:function TextureRegion(texture,x,y,width,height){this.texture=texture;this.setRegion(x,y,width,height)},setUVs:function(u,v,u2,v2){this.regionWidth=Math.round(Math.abs(u2-u)*this.texture.width);this.regionHeight=Math.round(Math.abs(v2-v)*this.texture.height);if(this.regionWidth==1&&this.regionHeight==1){var adjustX=.25/this.texture.width;u+=adjustX;u2-=adjustX;var adjustY=.25/this.texture.height;v+=adjustY;v2-=adjustY}this.u=u;this.v=v;this.u2=u2;this.v2=v2},setRegion:function(x,y,width,height){x=x||0;y=y||0;width=width===0||width?width:this.texture.width;height=height===0||height?height:this.texture.height;var invTexWidth=1/this.texture.width;var invTexHeight=1/this.texture.height;this.setUVs(x*invTexWidth,y*invTexHeight,(x+width)*invTexWidth,(y+height)*invTexHeight);this.regionWidth=Math.abs(width);this.regionHeight=Math.abs(height)},setFromRegion:function(region,x,y,width,height){this.texture=region.texture;this.set(region.getRegionX()+x,region.getRegionY()+y,width,height)},regionX:{get:function(){return Math.round(this.u*this.texture.width)}},regionY:{get:function(){return Math.round(this.v*this.texture.height)}},flip:function(x,y){var temp;if(x){temp=this.u;this.u=this.u2;this.u2=temp}if(y){temp=this.v;this.v=this.v2;this.v2=temp}}});module.exports=TextureRegion},{"./Texture":14,klasse:21}],16:[function(require,module,exports){var Class=require("klasse");var Signal=require("signals");var WebGLContext=new Class({initialize:function WebGLContext(width,height,view,contextAttributes){this.managedObjects=[];this.gl=null;this.view=view||document.createElement("canvas");this.width=this.view.width=width||300;this.height=this.view.height=height||150;this.contextAttributes=contextAttributes;this.valid=false;this.lost=new Signal;this.restored=new Signal;this.view.addEventListener("webglcontextlost",function(ev){ev.preventDefault();this._contextLost(ev)}.bind(this));this.view.addEventListener("webglcontextrestored",function(ev){ev.preventDefault();this._contextRestored(ev)}.bind(this));this._initContext();this.resize(this.width,this.height)},_initContext:function(){var err="";this.valid=false;try{this.gl=this.view.getContext("webgl",this.contextAttributes)||this.view.getContext("experimental-webgl",this.contextAttributes)}catch(e){this.gl=null}if(this.gl){this.valid=true}else{throw"WebGL Context Not Supported -- try enabling it or using a different browser"}},resize:function(width,height){this.width=width;this.height=height;this.view.width=width;this.view.height=height;var gl=this.gl;gl.viewport(0,0,this.width,this.height)},addManagedObject:function(obj){this.managedObjects.push(obj)},removeManagedObject:function(obj){var idx=this.managedObjects.indexOf(obj);if(idx>-1){this.managedObjects.splice(idx,1);return obj}return null},destroy:function(){for(var i=0;i<this.managedObjects.length;i++){var obj=this.managedObjects[i];if(obj&&typeof obj.destroy==="function")obj.destroy()}this.managedObjects.length=0;this.valid=false;this.gl=null;this.view=null;this.width=this.height=0},_contextLost:function(ev){this.valid=false;this.lost.dispatch(this)},_contextRestored:function(ev){this._initContext();for(var i=0;i<this.managedObjects.length;i++){this.managedObjects[i].create()}this.resize(this.width,this.height);this.restored.dispatch(this)}});module.exports=WebGLContext},{klasse:21,signals:23}],17:[function(require,module,exports){var Class=require("klasse");var Texture=require("../Texture");var FrameBuffer=new Class({initialize:function FrameBuffer(context,width,height,format){if(typeof context!=="object")throw"GL context not specified to FrameBuffer";this.id=null;this.context=context;this.texture=new Texture(context,width,height,format);this.context.addManagedObject(this);this.create()},width:{get:function(){return this.texture.width}},height:{get:function(){return this.texture.height}},create:function(){this.gl=this.context.gl;var gl=this.gl;var tex=this.texture;tex.bind();this.id=gl.createFramebuffer();gl.bindFramebuffer(gl.FRAMEBUFFER,this.id);gl.framebufferTexture2D(gl.FRAMEBUFFER,gl.COLOR_ATTACHMENT0,tex.target,tex.id,0);var result=gl.checkFramebufferStatus(gl.FRAMEBUFFER);if(result!=gl.FRAMEBUFFER_COMPLETE){this.destroy();var err="Framebuffer not complete";switch(result){case gl.FRAMEBUFFER_UNSUPPORTED:throw new Error(err+": unsupported");case gl.INCOMPLETE_DIMENSIONS:throw new Error(err+": incomplete dimensions");case gl.INCOMPLETE_ATTACHMENT:throw new Error(err+": incomplete attachment");case gl.INCOMPLETE_MISSING_ATTACHMENT:throw new Error(err+": missing attachment");default:throw new Error(err)}}gl.bindFramebuffer(gl.FRAMEBUFFER,null)},destroy:function(){var gl=this.gl;if(this.texture)this.texture.destroy();if(this.id&&this.gl)this.gl.deleteFramebuffer(this.id);if(this.context)this.context.removeManagedObject(this);this.id=null;this.gl=null;this.texture=null;this.context=null},begin:function(){var gl=this.gl;gl.viewport(0,0,this.texture.width,this.texture.height);gl.bindFramebuffer(gl.FRAMEBUFFER,this.id)},end:function(){var gl=this.gl;gl.viewport(0,0,this.context.width,this.context.height);gl.bindFramebuffer(gl.FRAMEBUFFER,null)}});module.exports=FrameBuffer},{"../Texture":14,klasse:21}],18:[function(require,module,exports){var Class=require("klasse");var Mesh=new Class({dirty:{set:function(val){this.verticesDirty=val;this.indicesDirty=val}},initialize:function Mesh(context,isStatic,numVerts,numIndices,vertexAttribs){if(typeof context!=="object")throw"GL context not specified to Mesh";if(!numVerts)throw"numVerts not specified, must be > 0";this.context=context;this.gl=context.gl;this.numVerts=null;this.numIndices=null;this.vertices=null;this.indices=null;this.vertexBuffer=null;this.indexBuffer=null;this.verticesDirty=true;this.indicesDirty=true;this.indexUsage=null;this.vertexUsage=null;this._vertexAttribs=null;this.vertexStride=null;this.numVerts=numVerts;this.numIndices=numIndices||0;this.vertexUsage=isStatic?this.gl.STATIC_DRAW:this.gl.DYNAMIC_DRAW;this.indexUsage=isStatic?this.gl.STATIC_DRAW:this.gl.DYNAMIC_DRAW;this._vertexAttribs=vertexAttribs||[];this.indicesDirty=true;this.verticesDirty=true;var totalNumComponents=0;for(var i=0;i<this._vertexAttribs.length;i++)totalNumComponents+=this._vertexAttribs[i].offsetCount;this.vertexStride=totalNumComponents*4;this.vertices=new Float32Array(this.numVerts);this.indices=new Uint16Array(this.numIndices);this.context.addManagedObject(this);this.create()},create:function(){this.gl=this.context.gl;var gl=this.gl;this.vertexBuffer=gl.createBuffer();this.indexBuffer=this.numIndices>0?gl.createBuffer():null;this.dirty=true},destroy:function(){this.vertices=null;this.indices=null;if(this.vertexBuffer&&this.gl)this.gl.deleteBuffer(this.vertexBuffer);if(this.indexBuffer&&this.gl)this.gl.deleteBuffer(this.indexBuffer);this.vertexBuffer=null;this.indexBuffer=null;if(this.context)this.context.removeManagedObject(this);this.gl=null;this.context=null},_updateBuffers:function(ignoreBind,subDataLength){var gl=this.gl;if(this.numIndices>0){if(!ignoreBind)gl.bindBuffer(gl.ELEMENT_ARRAY_BUFFER,this.indexBuffer);if(this.indicesDirty){gl.bufferData(gl.ELEMENT_ARRAY_BUFFER,this.indices,this.indexUsage);this.indicesDirty=false}}if(!ignoreBind)gl.bindBuffer(gl.ARRAY_BUFFER,this.vertexBuffer);if(this.verticesDirty){if(subDataLength){var view=this.vertices.subarray(0,subDataLength);gl.bufferSubData(gl.ARRAY_BUFFER,0,view)}else{gl.bufferData(gl.ARRAY_BUFFER,this.vertices,this.vertexUsage)}this.verticesDirty=false}},draw:function(primitiveType,count,offset,subDataLength){if(count===0)return;var gl=this.gl;offset=offset||0;this._updateBuffers(true,subDataLength);if(this.numIndices>0){gl.drawElements(primitiveType,count,gl.UNSIGNED_SHORT,offset*2)}else gl.drawArrays(primitiveType,offset,count)},bind:function(shader){var gl=this.gl;var offset=0;var stride=this.vertexStride;this._updateBuffers();for(var i=0;i<this._vertexAttribs.length;i++){var a=this._vertexAttribs[i];var loc=a.location===null?shader.getAttributeLocation(a.name):a.location;gl.enableVertexAttribArray(loc);gl.vertexAttribPointer(loc,a.numComponents,a.type||gl.FLOAT,a.normalize,stride,offset);offset+=a.offsetCount*4}},unbind:function(shader){var gl=this.gl;for(var i=0;i<this._vertexAttribs.length;i++){var a=this._vertexAttribs[i];var loc=a.location===null?shader.getAttributeLocation(a.name):a.location;gl.disableVertexAttribArray(loc)}}});Mesh.Attrib=new Class({name:null,numComponents:null,location:null,type:null,initialize:function(name,numComponents,location,type,normalize,offsetCount){this.name=name;this.numComponents=numComponents;this.location=typeof location==="number"?location:null;this.type=type;this.normalize=Boolean(normalize);this.offsetCount=typeof offsetCount==="number"?offsetCount:this.numComponents}});module.exports=Mesh},{klasse:21}],19:[function(require,module,exports){var Class=require("klasse");var ShaderProgram=new Class({initialize:function ShaderProgram(context,vertSource,fragSource,attributeLocations){if(!vertSource||!fragSource)throw"vertex and fragment shaders must be defined";if(typeof context!=="object")throw"GL context not specified to ShaderProgram";this.context=context;this.vertShader=null;this.fragShader=null;this.program=null;this.log="";this.uniformCache=null;this.attributeCache=null;this.attributeLocations=attributeLocations;this.vertSource=vertSource.trim();this.fragSource=fragSource.trim();this.context.addManagedObject(this);this.create()},create:function(){this.gl=this.context.gl;this._compileShaders()},_compileShaders:function(){var gl=this.gl;this.log="";this.vertShader=this._loadShader(gl.VERTEX_SHADER,this.vertSource);this.fragShader=this._loadShader(gl.FRAGMENT_SHADER,this.fragSource);if(!this.vertShader||!this.fragShader)throw"Error returned when calling createShader";this.program=gl.createProgram();gl.attachShader(this.program,this.vertShader);gl.attachShader(this.program,this.fragShader);if(this.attributeLocations){for(var key in this.attributeLocations){if(this.attributeLocations.hasOwnProperty(key)){gl.bindAttribLocation(this.program,Math.floor(this.attributeLocations[key]),key)}}}gl.linkProgram(this.program);this.log+=gl.getProgramInfoLog(this.program)||"";if(!gl.getProgramParameter(this.program,gl.LINK_STATUS)){throw"Error linking the shader program:\n"+this.log}this._fetchUniforms();this._fetchAttributes()},_fetchUniforms:function(){var gl=this.gl;this.uniformCache={};var len=gl.getProgramParameter(this.program,gl.ACTIVE_UNIFORMS);if(!len)return;for(var i=0;i<len;i++){var info=gl.getActiveUniform(this.program,i);if(info===null)continue;var name=info.name;var location=gl.getUniformLocation(this.program,name);this.uniformCache[name]={size:info.size,type:info.type,location:location}}},_fetchAttributes:function(){var gl=this.gl;this.attributeCache={};var len=gl.getProgramParameter(this.program,gl.ACTIVE_ATTRIBUTES);if(!len)return;for(var i=0;i<len;i++){var info=gl.getActiveAttrib(this.program,i);if(info===null)continue;var name=info.name;var location=gl.getAttribLocation(this.program,name);this.attributeCache[name]={size:info.size,type:info.type,location:location}}},_loadShader:function(type,source){var gl=this.gl;var shader=gl.createShader(type);if(!shader)return-1;gl.shaderSource(shader,source);gl.compileShader(shader);var logResult=gl.getShaderInfoLog(shader)||"";if(logResult){var typeStr=type===gl.VERTEX_SHADER?"vertex":"fragment";logResult="Error compiling "+typeStr+" shader:\n"+logResult}this.log+=logResult;if(!gl.getShaderParameter(shader,gl.COMPILE_STATUS)){throw this.log}return shader},bind:function(){this.gl.useProgram(this.program)},destroy:function(){if(this.context)this.context.removeManagedObject(this);if(this.gl){var gl=this.gl;gl.detachShader(this.vertShader);gl.detachShader(this.fragShader);gl.deleteShader(this.vertShader);gl.deleteShader(this.fragShader);gl.deleteProgram(this.program)}this.attributeCache=null;this.uniformCache=null;this.vertShader=null;this.fragShader=null;this.program=null;this.gl=null;this.context=null},getUniformInfo:function(name){return this.uniformCache[name]||null},getAttributeInfo:function(name){return this.attributeCache[name]||null},getAttributeLocation:function(name){var info=this.getAttributeInfo(name);return info?info.location:null},getUniformLocation:function(name){var info=this.getUniformInfo(name);return info?info.location:null},hasUniform:function(name){return this.getUniformInfo(name)!==null},hasAttribute:function(name){return this.getAttributeInfo(name)!==null},getUniform:function(name){return this.gl.getUniform(this.program,this.getUniformLocation(name))},getUniformAt:function(location){return this.gl.getUniform(this.program,location)},setUniformi:function(name,x,y,z,w){var gl=this.gl;var loc=this.getUniformLocation(name);if(!loc)return false;switch(arguments.length){case 2:gl.uniform1i(loc,x);return true;case 3:gl.uniform2i(loc,x,y);return true;case 4:gl.uniform3i(loc,x,y,z);return true;case 5:gl.uniform4i(loc,x,y,z,w);return true;default:throw"invalid arguments to setUniformi"}},setUniformf:function(name,x,y,z,w){var gl=this.gl;var loc=this.getUniformLocation(name);if(!loc)return false;switch(arguments.length){case 2:gl.uniform1f(loc,x);return true;case 3:gl.uniform2f(loc,x,y);return true;case 4:gl.uniform3f(loc,x,y,z);return true;case 5:gl.uniform4f(loc,x,y,z,w);return true;default:throw"invalid arguments to setUniformf"}},setUniformfv:function(name,arrayBuffer,count){count=count||arrayBuffer.length;var gl=this.gl;var loc=this.getUniformLocation(name);if(!loc)return false;switch(count){case 1:gl.uniform1fv(loc,arrayBuffer);return true;case 2:gl.uniform2fv(loc,arrayBuffer);return true;case 3:gl.uniform3fv(loc,arrayBuffer);return true;case 4:gl.uniform4fv(loc,arrayBuffer);return true;default:throw"invalid arguments to setUniformf"}},setUniformiv:function(name,arrayBuffer,count){count=count||arrayBuffer.length;var gl=this.gl;var loc=this.getUniformLocation(name);if(!loc)return false;switch(count){case 1:gl.uniform1iv(loc,arrayBuffer);return true;case 2:gl.uniform2iv(loc,arrayBuffer);return true;case 3:gl.uniform3iv(loc,arrayBuffer);return true;case 4:gl.uniform4iv(loc,arrayBuffer);return true;default:throw"invalid arguments to setUniformf"}},setUniformMatrix3:function(name,mat,transpose){var arr=typeof mat==="object"&&mat.val?mat.val:mat;transpose=!!transpose;var gl=this.gl;var loc=this.getUniformLocation(name);if(!loc)return false;gl.uniformMatrix3fv(loc,transpose,arr)},setUniformMatrix4:function(name,mat,transpose){var arr=typeof mat==="object"&&mat.val?mat.val:mat;transpose=!!transpose;var gl=this.gl;var loc=this.getUniformLocation(name);if(!loc)return false;gl.uniformMatrix4fv(loc,transpose,arr)}});ShaderProgram.POSITION_ATTRIBUTE="Position";ShaderProgram.NORMAL_ATTRIBUTE="Normal";ShaderProgram.COLOR_ATTRIBUTE="Color";ShaderProgram.TEXCOORD_ATTRIBUTE="TexCoord";module.exports=ShaderProgram},{klasse:21}],20:[function(require,module,exports){module.exports={BaseBatch:require("./BaseBatch.js"),SpriteBatch:require("./SpriteBatch.js"),Texture:require("./Texture.js"),TextureRegion:require("./TextureRegion.js"),WebGLContext:require("./WebGLContext.js"),FrameBuffer:require("./glutils/FrameBuffer.js"),Mesh:require("./glutils/Mesh.js"),ShaderProgram:require("./glutils/ShaderProgram.js")}},{"./BaseBatch.js":12,"./SpriteBatch.js":13,"./Texture.js":14,"./TextureRegion.js":15,"./WebGLContext.js":16,"./glutils/FrameBuffer.js":17,"./glutils/Mesh.js":18,"./glutils/ShaderProgram.js":19}],21:[function(require,module,exports){function hasGetterOrSetter(def){return!!def.get&&typeof def.get==="function"||!!def.set&&typeof def.set==="function"}function getProperty(definition,k,isClassDescriptor){var def=isClassDescriptor?definition[k]:Object.getOwnPropertyDescriptor(definition,k);if(!isClassDescriptor&&def.value&&typeof def.value==="object"){def=def.value}if(def&&hasGetterOrSetter(def)){if(typeof def.enumerable==="undefined")def.enumerable=true;if(typeof def.configurable==="undefined")def.configurable=true;return def}else{return false}}function hasNonConfigurable(obj,k){var prop=Object.getOwnPropertyDescriptor(obj,k);if(!prop)return false;if(prop.value&&typeof prop.value==="object")prop=prop.value;if(prop.configurable===false)return true;return false}function extend(ctor,definition,isClassDescriptor,extend){for(var k in definition){if(!definition.hasOwnProperty(k))continue;var def=getProperty(definition,k,isClassDescriptor);if(def!==false){var parent=extend||ctor;if(hasNonConfigurable(parent.prototype,k)){if(Class.ignoreFinals)continue;throw new Error("cannot override final property '"+k+"', set Class.ignoreFinals = true to skip")}Object.defineProperty(ctor.prototype,k,def)}else{ctor.prototype[k]=definition[k]}}}function mixin(myClass,mixins){if(!mixins)return;if(!Array.isArray(mixins))mixins=[mixins];for(var i=0;i<mixins.length;i++){extend(myClass,mixins[i].prototype||mixins[i])}}function Class(definition){if(!definition)definition={};var initialize;var Extends;if(definition.initialize){if(typeof definition.initialize!=="function")throw new Error("initialize must be a function");initialize=definition.initialize;delete definition.initialize}else{if(definition.Extends){var base=definition.Extends;initialize=function(){base.apply(this,arguments)}}else{initialize=function(){}}}if(definition.Extends){initialize.prototype=Object.create(definition.Extends.prototype);initialize.prototype.constructor=initialize;Extends=definition.Extends;delete definition.Extends}else{initialize.prototype.constructor=initialize}var mixins=null;if(definition.Mixins){mixins=definition.Mixins;delete definition.Mixins}mixin(initialize,mixins);extend(initialize,definition,true,Extends);return initialize}Class.extend=extend;Class.mixin=mixin;Class.ignoreFinals=false;module.exports=Class},{}],22:[function(require,module,exports){var int8=new Int8Array(4);var int32=new Int32Array(int8.buffer,0,1);var float32=new Float32Array(int8.buffer,0,1);var NumberUtil=function(){};NumberUtil.intBitsToFloat=function(i){int32[0]=i;return float32[0]};NumberUtil.floatToIntBits=function(f){float32[0]=f;return int32[0]};NumberUtil.intToFloatColor=function(value){return NumberUtil.intBitsToFloat(value&4278190079)};NumberUtil.colorToFloat=function(r,g,b,a){var bits=a<<24|b<<16|g<<8|r;return NumberUtil.intToFloatColor(bits)};NumberUtil.isPowerOfTwo=function(n){return(n&n-1)==0};NumberUtil.nextPowerOfTwo=function(n){n--;n|=n>>1;n|=n>>2;n|=n>>4;n|=n>>8;n|=n>>16;return n+1};module.exports=NumberUtil},{}],23:[function(require,module,exports){(function(global){function SignalBinding(signal,listener,isOnce,listenerContext,priority){this._listener=listener;this._isOnce=isOnce;this.context=listenerContext;this._signal=signal;this._priority=priority||0}SignalBinding.prototype={active:true,params:null,execute:function(paramsArr){var handlerReturn,params;if(this.active&&!!this._listener){params=this.params?this.params.concat(paramsArr):paramsArr;handlerReturn=this._listener.apply(this.context,params);if(this._isOnce){this.detach()}}return handlerReturn},detach:function(){return this.isBound()?this._signal.remove(this._listener,this.context):null},isBound:function(){return!!this._signal&&!!this._listener},isOnce:function(){return this._isOnce},getListener:function(){return this._listener},getSignal:function(){return this._signal},_destroy:function(){delete this._signal;delete this._listener;delete this.context},toString:function(){return"[SignalBinding isOnce:"+this._isOnce+", isBound:"+this.isBound()+", active:"+this.active+"]"
}};function validateListener(listener,fnName){if(typeof listener!=="function"){throw new Error("listener is a required param of {fn}() and should be a Function.".replace("{fn}",fnName))}}function Signal(){this._bindings=[];this._prevParams=null;var self=this;this.dispatch=function(){Signal.prototype.dispatch.apply(self,arguments)}}Signal.prototype={VERSION:"1.0.0",memorize:false,_shouldPropagate:true,active:true,_registerListener:function(listener,isOnce,listenerContext,priority){var prevIndex=this._indexOfListener(listener,listenerContext),binding;if(prevIndex!==-1){binding=this._bindings[prevIndex];if(binding.isOnce()!==isOnce){throw new Error("You cannot add"+(isOnce?"":"Once")+"() then add"+(!isOnce?"":"Once")+"() the same listener without removing the relationship first.")}}else{binding=new SignalBinding(this,listener,isOnce,listenerContext,priority);this._addBinding(binding)}if(this.memorize&&this._prevParams){binding.execute(this._prevParams)}return binding},_addBinding:function(binding){var n=this._bindings.length;do{--n}while(this._bindings[n]&&binding._priority<=this._bindings[n]._priority);this._bindings.splice(n+1,0,binding)},_indexOfListener:function(listener,context){var n=this._bindings.length,cur;while(n--){cur=this._bindings[n];if(cur._listener===listener&&cur.context===context){return n}}return-1},has:function(listener,context){return this._indexOfListener(listener,context)!==-1},add:function(listener,listenerContext,priority){validateListener(listener,"add");return this._registerListener(listener,false,listenerContext,priority)},addOnce:function(listener,listenerContext,priority){validateListener(listener,"addOnce");return this._registerListener(listener,true,listenerContext,priority)},remove:function(listener,context){validateListener(listener,"remove");var i=this._indexOfListener(listener,context);if(i!==-1){this._bindings[i]._destroy();this._bindings.splice(i,1)}return listener},removeAll:function(){var n=this._bindings.length;while(n--){this._bindings[n]._destroy()}this._bindings.length=0},getNumListeners:function(){return this._bindings.length},halt:function(){this._shouldPropagate=false},dispatch:function(params){if(!this.active){return}var paramsArr=Array.prototype.slice.call(arguments),n=this._bindings.length,bindings;if(this.memorize){this._prevParams=paramsArr}if(!n){return}bindings=this._bindings.slice();this._shouldPropagate=true;do{n--}while(bindings[n]&&this._shouldPropagate&&bindings[n].execute(paramsArr)!==false)},forget:function(){this._prevParams=null},dispose:function(){this.removeAll();delete this._bindings;delete this._prevParams},toString:function(){return"[Signal active:"+this.active+" numListeners:"+this.getNumListeners()+"]"}};var signals=Signal;signals.Signal=Signal;if(typeof define==="function"&&define.amd){define(function(){return signals})}else if(typeof module!=="undefined"&&module.exports){module.exports=signals}else{global["signals"]=signals}})(this)},{}],24:[function(require,module,exports){module.exports=require(21)},{}],25:[function(require,module,exports){module.exports=require(23)},{}],26:[function(require,module,exports){var ARRAY_TYPE=typeof Float32Array!=="undefined"?Float32Array:Array;function Matrix3(m){this.val=new ARRAY_TYPE(9);if(m){this.copy(m)}else{this.idt()}}var mat3=Matrix3.prototype;mat3.clone=function(){return new Matrix3(this)};mat3.set=function(otherMat){return this.copy(otherMat)};mat3.copy=function(otherMat){var out=this.val,a=otherMat.val;out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];return this};mat3.fromMat4=function(m){var a=m.val,out=this.val;out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[4];out[4]=a[5];out[5]=a[6];out[6]=a[8];out[7]=a[9];out[8]=a[10];return this};mat3.fromArray=function(a){var out=this.val;out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];return this};mat3.identity=function(){var out=this.val;out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=1;out[5]=0;out[6]=0;out[7]=0;out[8]=1;return this};mat3.transpose=function(){var a=this.val,a01=a[1],a02=a[2],a12=a[5];a[1]=a[3];a[2]=a[6];a[3]=a01;a[5]=a[7];a[6]=a02;a[7]=a12;return this};mat3.invert=function(){var a=this.val,a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],b01=a22*a11-a12*a21,b11=-a22*a10+a12*a20,b21=a21*a10-a11*a20,det=a00*b01+a01*b11+a02*b21;if(!det){return null}det=1/det;a[0]=b01*det;a[1]=(-a22*a01+a02*a21)*det;a[2]=(a12*a01-a02*a11)*det;a[3]=b11*det;a[4]=(a22*a00-a02*a20)*det;a[5]=(-a12*a00+a02*a10)*det;a[6]=b21*det;a[7]=(-a21*a00+a01*a20)*det;a[8]=(a11*a00-a01*a10)*det;return this};mat3.adjoint=function(){var a=this.val,a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8];a[0]=a11*a22-a12*a21;a[1]=a02*a21-a01*a22;a[2]=a01*a12-a02*a11;a[3]=a12*a20-a10*a22;a[4]=a00*a22-a02*a20;a[5]=a02*a10-a00*a12;a[6]=a10*a21-a11*a20;a[7]=a01*a20-a00*a21;a[8]=a00*a11-a01*a10;return this};mat3.determinant=function(){var a=this.val,a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8];return a00*(a22*a11-a12*a21)+a01*(-a22*a10+a12*a20)+a02*(a21*a10-a11*a20)};mat3.multiply=function(otherMat){var a=this.val,b=otherMat.val,a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],a20=a[6],a21=a[7],a22=a[8],b00=b[0],b01=b[1],b02=b[2],b10=b[3],b11=b[4],b12=b[5],b20=b[6],b21=b[7],b22=b[8];a[0]=b00*a00+b01*a10+b02*a20;a[1]=b00*a01+b01*a11+b02*a21;a[2]=b00*a02+b01*a12+b02*a22;a[3]=b10*a00+b11*a10+b12*a20;a[4]=b10*a01+b11*a11+b12*a21;a[5]=b10*a02+b11*a12+b12*a22;a[6]=b20*a00+b21*a10+b22*a20;a[7]=b20*a01+b21*a11+b22*a21;a[8]=b20*a02+b21*a12+b22*a22;return this};mat3.translate=function(v){var a=this.val,x=v.x,y=v.y;a[6]=x*a[0]+y*a[3]+a[6];a[7]=x*a[1]+y*a[4]+a[7];a[8]=x*a[2]+y*a[5]+a[8];return this};mat3.rotate=function(rad){var a=this.val,a00=a[0],a01=a[1],a02=a[2],a10=a[3],a11=a[4],a12=a[5],s=Math.sin(rad),c=Math.cos(rad);a[0]=c*a00+s*a10;a[1]=c*a01+s*a11;a[2]=c*a02+s*a12;a[3]=c*a10-s*a00;a[4]=c*a11-s*a01;a[5]=c*a12-s*a02;return this};mat3.scale=function(v){var a=this.val,x=v.x,y=v.y;a[0]=x*a[0];a[1]=x*a[1];a[2]=x*a[2];a[3]=y*a[3];a[4]=y*a[4];a[5]=y*a[5];return this};mat3.fromQuat=function(q){var x=q.x,y=q.y,z=q.z,w=q.w,x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2,out=this.val;out[0]=1-(yy+zz);out[3]=xy+wz;out[6]=xz-wy;out[1]=xy-wz;out[4]=1-(xx+zz);out[7]=yz+wx;out[2]=xz+wy;out[5]=yz-wx;out[8]=1-(xx+yy);return this};mat3.normalFromMat4=function(m){var a=m.val,out=this.val,a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32,det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;if(!det){return null}det=1/det;out[0]=(a11*b11-a12*b10+a13*b09)*det;out[1]=(a12*b08-a10*b11-a13*b07)*det;out[2]=(a10*b10-a11*b08+a13*b06)*det;out[3]=(a02*b10-a01*b11-a03*b09)*det;out[4]=(a00*b11-a02*b08+a03*b07)*det;out[5]=(a01*b08-a00*b10-a03*b06)*det;out[6]=(a31*b05-a32*b04+a33*b03)*det;out[7]=(a32*b02-a30*b05-a33*b01)*det;out[8]=(a30*b04-a31*b02+a33*b00)*det;return this};mat3.mul=mat3.multiply;mat3.idt=mat3.identity;mat3.reset=mat3.idt;mat3.toString=function(){var a=this.val;return"Matrix3("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+")"};mat3.str=mat3.toString;module.exports=Matrix3},{}],27:[function(require,module,exports){var ARRAY_TYPE=typeof Float32Array!=="undefined"?Float32Array:Array;var EPSILON=1e-6;function Matrix4(m){this.val=new ARRAY_TYPE(16);if(m){this.copy(m)}else{this.idt()}}var mat4=Matrix4.prototype;mat4.clone=function(){return new Matrix4(this)};mat4.set=function(otherMat){return this.copy(otherMat)};mat4.copy=function(otherMat){var out=this.val,a=otherMat.val;out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];out[9]=a[9];out[10]=a[10];out[11]=a[11];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];return this};mat4.fromArray=function(a){var out=this.val;out[0]=a[0];out[1]=a[1];out[2]=a[2];out[3]=a[3];out[4]=a[4];out[5]=a[5];out[6]=a[6];out[7]=a[7];out[8]=a[8];out[9]=a[9];out[10]=a[10];out[11]=a[11];out[12]=a[12];out[13]=a[13];out[14]=a[14];out[15]=a[15];return this};mat4.identity=function(){var out=this.val;out[0]=1;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=1;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=1;out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return this};mat4.transpose=function(){var a=this.val,a01=a[1],a02=a[2],a03=a[3],a12=a[6],a13=a[7],a23=a[11];a[1]=a[4];a[2]=a[8];a[3]=a[12];a[4]=a01;a[6]=a[9];a[7]=a[13];a[8]=a02;a[9]=a12;a[11]=a[14];a[12]=a03;a[13]=a13;a[14]=a23;return this};mat4.invert=function(){var a=this.val,a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32,det=b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06;if(!det){return null}det=1/det;a[0]=(a11*b11-a12*b10+a13*b09)*det;a[1]=(a02*b10-a01*b11-a03*b09)*det;a[2]=(a31*b05-a32*b04+a33*b03)*det;a[3]=(a22*b04-a21*b05-a23*b03)*det;a[4]=(a12*b08-a10*b11-a13*b07)*det;a[5]=(a00*b11-a02*b08+a03*b07)*det;a[6]=(a32*b02-a30*b05-a33*b01)*det;a[7]=(a20*b05-a22*b02+a23*b01)*det;a[8]=(a10*b10-a11*b08+a13*b06)*det;a[9]=(a01*b08-a00*b10-a03*b06)*det;a[10]=(a30*b04-a31*b02+a33*b00)*det;a[11]=(a21*b02-a20*b04-a23*b00)*det;a[12]=(a11*b07-a10*b09-a12*b06)*det;a[13]=(a00*b09-a01*b07+a02*b06)*det;a[14]=(a31*b01-a30*b03-a32*b00)*det;a[15]=(a20*b03-a21*b01+a22*b00)*det;return this};mat4.adjoint=function(){var a=this.val,a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15];a[0]=a11*(a22*a33-a23*a32)-a21*(a12*a33-a13*a32)+a31*(a12*a23-a13*a22);a[1]=-(a01*(a22*a33-a23*a32)-a21*(a02*a33-a03*a32)+a31*(a02*a23-a03*a22));a[2]=a01*(a12*a33-a13*a32)-a11*(a02*a33-a03*a32)+a31*(a02*a13-a03*a12);a[3]=-(a01*(a12*a23-a13*a22)-a11*(a02*a23-a03*a22)+a21*(a02*a13-a03*a12));a[4]=-(a10*(a22*a33-a23*a32)-a20*(a12*a33-a13*a32)+a30*(a12*a23-a13*a22));a[5]=a00*(a22*a33-a23*a32)-a20*(a02*a33-a03*a32)+a30*(a02*a23-a03*a22);a[6]=-(a00*(a12*a33-a13*a32)-a10*(a02*a33-a03*a32)+a30*(a02*a13-a03*a12));a[7]=a00*(a12*a23-a13*a22)-a10*(a02*a23-a03*a22)+a20*(a02*a13-a03*a12);a[8]=a10*(a21*a33-a23*a31)-a20*(a11*a33-a13*a31)+a30*(a11*a23-a13*a21);a[9]=-(a00*(a21*a33-a23*a31)-a20*(a01*a33-a03*a31)+a30*(a01*a23-a03*a21));a[10]=a00*(a11*a33-a13*a31)-a10*(a01*a33-a03*a31)+a30*(a01*a13-a03*a11);a[11]=-(a00*(a11*a23-a13*a21)-a10*(a01*a23-a03*a21)+a20*(a01*a13-a03*a11));a[12]=-(a10*(a21*a32-a22*a31)-a20*(a11*a32-a12*a31)+a30*(a11*a22-a12*a21));a[13]=a00*(a21*a32-a22*a31)-a20*(a01*a32-a02*a31)+a30*(a01*a22-a02*a21);a[14]=-(a00*(a11*a32-a12*a31)-a10*(a01*a32-a02*a31)+a30*(a01*a12-a02*a11));a[15]=a00*(a11*a22-a12*a21)-a10*(a01*a22-a02*a21)+a20*(a01*a12-a02*a11);return this};mat4.determinant=function(){var a=this.val,a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15],b00=a00*a11-a01*a10,b01=a00*a12-a02*a10,b02=a00*a13-a03*a10,b03=a01*a12-a02*a11,b04=a01*a13-a03*a11,b05=a02*a13-a03*a12,b06=a20*a31-a21*a30,b07=a20*a32-a22*a30,b08=a20*a33-a23*a30,b09=a21*a32-a22*a31,b10=a21*a33-a23*a31,b11=a22*a33-a23*a32;return b00*b11-b01*b10+b02*b09+b03*b08-b04*b07+b05*b06};mat4.multiply=function(otherMat){var a=this.val,b=otherMat.val,a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11],a30=a[12],a31=a[13],a32=a[14],a33=a[15];var b0=b[0],b1=b[1],b2=b[2],b3=b[3];a[0]=b0*a00+b1*a10+b2*a20+b3*a30;a[1]=b0*a01+b1*a11+b2*a21+b3*a31;a[2]=b0*a02+b1*a12+b2*a22+b3*a32;a[3]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[4];b1=b[5];b2=b[6];b3=b[7];a[4]=b0*a00+b1*a10+b2*a20+b3*a30;a[5]=b0*a01+b1*a11+b2*a21+b3*a31;a[6]=b0*a02+b1*a12+b2*a22+b3*a32;a[7]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[8];b1=b[9];b2=b[10];b3=b[11];a[8]=b0*a00+b1*a10+b2*a20+b3*a30;a[9]=b0*a01+b1*a11+b2*a21+b3*a31;a[10]=b0*a02+b1*a12+b2*a22+b3*a32;a[11]=b0*a03+b1*a13+b2*a23+b3*a33;b0=b[12];b1=b[13];b2=b[14];b3=b[15];a[12]=b0*a00+b1*a10+b2*a20+b3*a30;a[13]=b0*a01+b1*a11+b2*a21+b3*a31;a[14]=b0*a02+b1*a12+b2*a22+b3*a32;a[15]=b0*a03+b1*a13+b2*a23+b3*a33;return this};mat4.translate=function(v){var x=v.x,y=v.y,z=v.z,a=this.val;a[12]=a[0]*x+a[4]*y+a[8]*z+a[12];a[13]=a[1]*x+a[5]*y+a[9]*z+a[13];a[14]=a[2]*x+a[6]*y+a[10]*z+a[14];a[15]=a[3]*x+a[7]*y+a[11]*z+a[15];return this};mat4.scale=function(v){var x=v.x,y=v.y,z=v.z,a=this.val;a[0]=a[0]*x;a[1]=a[1]*x;a[2]=a[2]*x;a[3]=a[3]*x;a[4]=a[4]*y;a[5]=a[5]*y;a[6]=a[6]*y;a[7]=a[7]*y;a[8]=a[8]*z;a[9]=a[9]*z;a[10]=a[10]*z;a[11]=a[11]*z;a[12]=a[12];a[13]=a[13];a[14]=a[14];a[15]=a[15];return this};mat4.rotate=function(rad,axis){var a=this.val,x=axis.x,y=axis.y,z=axis.z,len=Math.sqrt(x*x+y*y+z*z),s,c,t,a00,a01,a02,a03,a10,a11,a12,a13,a20,a21,a22,a23,b00,b01,b02,b10,b11,b12,b20,b21,b22;if(Math.abs(len)<EPSILON){return null}len=1/len;x*=len;y*=len;z*=len;s=Math.sin(rad);c=Math.cos(rad);t=1-c;a00=a[0];a01=a[1];a02=a[2];a03=a[3];a10=a[4];a11=a[5];a12=a[6];a13=a[7];a20=a[8];a21=a[9];a22=a[10];a23=a[11];b00=x*x*t+c;b01=y*x*t+z*s;b02=z*x*t-y*s;b10=x*y*t-z*s;b11=y*y*t+c;b12=z*y*t+x*s;b20=x*z*t+y*s;b21=y*z*t-x*s;b22=z*z*t+c;a[0]=a00*b00+a10*b01+a20*b02;a[1]=a01*b00+a11*b01+a21*b02;a[2]=a02*b00+a12*b01+a22*b02;a[3]=a03*b00+a13*b01+a23*b02;a[4]=a00*b10+a10*b11+a20*b12;a[5]=a01*b10+a11*b11+a21*b12;a[6]=a02*b10+a12*b11+a22*b12;a[7]=a03*b10+a13*b11+a23*b12;a[8]=a00*b20+a10*b21+a20*b22;a[9]=a01*b20+a11*b21+a21*b22;a[10]=a02*b20+a12*b21+a22*b22;a[11]=a03*b20+a13*b21+a23*b22;return this};mat4.rotateX=function(rad){var a=this.val,s=Math.sin(rad),c=Math.cos(rad),a10=a[4],a11=a[5],a12=a[6],a13=a[7],a20=a[8],a21=a[9],a22=a[10],a23=a[11];a[4]=a10*c+a20*s;a[5]=a11*c+a21*s;a[6]=a12*c+a22*s;a[7]=a13*c+a23*s;a[8]=a20*c-a10*s;a[9]=a21*c-a11*s;a[10]=a22*c-a12*s;a[11]=a23*c-a13*s;return this};mat4.rotateY=function(rad){var a=this.val,s=Math.sin(rad),c=Math.cos(rad),a00=a[0],a01=a[1],a02=a[2],a03=a[3],a20=a[8],a21=a[9],a22=a[10],a23=a[11];a[0]=a00*c-a20*s;a[1]=a01*c-a21*s;a[2]=a02*c-a22*s;a[3]=a03*c-a23*s;a[8]=a00*s+a20*c;a[9]=a01*s+a21*c;a[10]=a02*s+a22*c;a[11]=a03*s+a23*c;return this};mat4.rotateZ=function(rad){var a=this.val,s=Math.sin(rad),c=Math.cos(rad),a00=a[0],a01=a[1],a02=a[2],a03=a[3],a10=a[4],a11=a[5],a12=a[6],a13=a[7];a[0]=a00*c+a10*s;a[1]=a01*c+a11*s;a[2]=a02*c+a12*s;a[3]=a03*c+a13*s;a[4]=a10*c-a00*s;a[5]=a11*c-a01*s;a[6]=a12*c-a02*s;a[7]=a13*c-a03*s;return this};mat4.fromRotationTranslation=function(q,v){var out=this.val,x=q.x,y=q.y,z=q.z,w=q.w,x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;out[0]=1-(yy+zz);out[1]=xy+wz;out[2]=xz-wy;out[3]=0;out[4]=xy-wz;out[5]=1-(xx+zz);out[6]=yz+wx;out[7]=0;out[8]=xz+wy;out[9]=yz-wx;out[10]=1-(xx+yy);out[11]=0;out[12]=v.x;out[13]=v.y;out[14]=v.z;out[15]=1;return this};mat4.fromQuat=function(q){var out=this.val,x=q.x,y=q.y,z=q.z,w=q.w,x2=x+x,y2=y+y,z2=z+z,xx=x*x2,xy=x*y2,xz=x*z2,yy=y*y2,yz=y*z2,zz=z*z2,wx=w*x2,wy=w*y2,wz=w*z2;out[0]=1-(yy+zz);out[1]=xy+wz;out[2]=xz-wy;out[3]=0;out[4]=xy-wz;out[5]=1-(xx+zz);out[6]=yz+wx;out[7]=0;out[8]=xz+wy;out[9]=yz-wx;out[10]=1-(xx+yy);out[11]=0;out[12]=0;out[13]=0;out[14]=0;out[15]=1;return this};mat4.frustum=function(left,right,bottom,top,near,far){var out=this.val,rl=1/(right-left),tb=1/(top-bottom),nf=1/(near-far);out[0]=near*2*rl;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=near*2*tb;out[6]=0;out[7]=0;out[8]=(right+left)*rl;out[9]=(top+bottom)*tb;out[10]=(far+near)*nf;out[11]=-1;out[12]=0;out[13]=0;out[14]=far*near*2*nf;out[15]=0;return this};mat4.perspective=function(fovy,aspect,near,far){var out=this.val,f=1/Math.tan(fovy/2),nf=1/(near-far);out[0]=f/aspect;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=f;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=(far+near)*nf;out[11]=-1;out[12]=0;out[13]=0;out[14]=2*far*near*nf;out[15]=0;return this};mat4.ortho=function(left,right,bottom,top,near,far){var out=this.val,lr=1/(left-right),bt=1/(bottom-top),nf=1/(near-far);out[0]=-2*lr;out[1]=0;out[2]=0;out[3]=0;out[4]=0;out[5]=-2*bt;out[6]=0;out[7]=0;out[8]=0;out[9]=0;out[10]=2*nf;out[11]=0;out[12]=(left+right)*lr;out[13]=(top+bottom)*bt;out[14]=(far+near)*nf;out[15]=1;return this};mat4.lookAt=function(eye,center,up){var out=this.val,x0,x1,x2,y0,y1,y2,z0,z1,z2,len,eyex=eye.x,eyey=eye.y,eyez=eye.z,upx=up.x,upy=up.y,upz=up.z,centerx=center.x,centery=center.y,centerz=center.z;if(Math.abs(eyex-centerx)<EPSILON&&Math.abs(eyey-centery)<EPSILON&&Math.abs(eyez-centerz)<EPSILON){return this.identity()}z0=eyex-centerx;z1=eyey-centery;z2=eyez-centerz;len=1/Math.sqrt(z0*z0+z1*z1+z2*z2);z0*=len;z1*=len;z2*=len;x0=upy*z2-upz*z1;x1=upz*z0-upx*z2;x2=upx*z1-upy*z0;len=Math.sqrt(x0*x0+x1*x1+x2*x2);if(!len){x0=0;x1=0;x2=0}else{len=1/len;x0*=len;x1*=len;x2*=len}y0=z1*x2-z2*x1;y1=z2*x0-z0*x2;y2=z0*x1-z1*x0;len=Math.sqrt(y0*y0+y1*y1+y2*y2);if(!len){y0=0;y1=0;y2=0}else{len=1/len;y0*=len;y1*=len;y2*=len}out[0]=x0;out[1]=y0;out[2]=z0;out[3]=0;out[4]=x1;out[5]=y1;out[6]=z1;out[7]=0;out[8]=x2;out[9]=y2;out[10]=z2;out[11]=0;out[12]=-(x0*eyex+x1*eyey+x2*eyez);out[13]=-(y0*eyex+y1*eyey+y2*eyez);out[14]=-(z0*eyex+z1*eyey+z2*eyez);out[15]=1;return this};mat4.mul=mat4.multiply;mat4.idt=mat4.identity;mat4.reset=mat4.idt;mat4.toString=function(){var a=this.val;return"Matrix4("+a[0]+", "+a[1]+", "+a[2]+", "+a[3]+", "+a[4]+", "+a[5]+", "+a[6]+", "+a[7]+", "+a[8]+", "+a[9]+", "+a[10]+", "+a[11]+", "+a[12]+", "+a[13]+", "+a[14]+", "+a[15]+")"};mat4.str=mat4.toString;module.exports=Matrix4},{}],28:[function(require,module,exports){var Vector3=require("./Vector3");var Matrix3=require("./Matrix3");var common=require("./common");var s_iNext=typeof Int8Array!=="undefined"?new Int8Array([1,2,0]):[1,2,0];var tmp=typeof Float32Array!=="undefined"?new Float32Array([0,0,0]):[0,0,0];var xUnitVec3=new Vector3(1,0,0);var yUnitVec3=new Vector3(0,1,0);var tmpvec=new Vector3;var tmpMat3=new Matrix3;function Quaternion(x,y,z,w){if(typeof x==="object"){this.x=x.x||0;this.y=x.y||0;this.z=x.z||0;this.w=x.w||0}else{this.x=x||0;this.y=y||0;this.z=z||0;this.w=w||0}}var quat=Quaternion.prototype;for(var k in common){quat[k]=common[k]}quat.rotationTo=function(a,b){var dot=a.x*b.x+a.y*b.y+a.z*b.z;if(dot<-.999999){if(tmpvec.copy(xUnitVec3).cross(a).len()<1e-6)tmpvec.copy(yUnitVec3).cross(a);tmpvec.normalize();return this.setAxisAngle(tmpvec,Math.PI)}else if(dot>.999999){this.x=0;this.y=0;this.z=0;this.w=1;return this}else{tmpvec.copy(a).cross(b);this.x=tmpvec.x;this.y=tmpvec.y;this.z=tmpvec.z;this.w=1+dot;return this.normalize()}};quat.setAxes=function(view,right,up){var m=tmpMat3.val;m[0]=right.x;m[3]=right.y;m[6]=right.z;m[1]=uquat.x;m[4]=uquat.y;m[7]=uquat.z;m[2]=view.x;m[5]=view.y;m[8]=view.z;return this.fromMat3(tmpMat3).normalize()};quat.identity=function(){this.x=this.y=this.z=0;this.w=1;return this};quat.setAxisAngle=function(axis,rad){rad=rad*.5;var s=Math.sin(rad);this.x=s*axis.x;this.y=s*axis.y;this.z=s*axis.z;this.w=Math.cos(rad);return this};quat.multiply=function(b){var ax=this.x,ay=this.y,az=this.z,aw=this.w,bx=b.x,by=b.y,bz=b.z,bw=b.w;this.x=ax*bw+aw*bx+ay*bz-az*by;this.y=ay*bw+aw*by+az*bx-ax*bz;this.z=az*bw+aw*bz+ax*by-ay*bx;this.w=aw*bw-ax*bx-ay*by-az*bz;return this};quat.slerp=function(b,t){var ax=this.x,ay=this.y,az=this.y,aw=this.y,bx=b.x,by=b.y,bz=b.z,bw=b.w;var omega,cosom,sinom,scale0,scale1;cosom=ax*bx+ay*by+az*bz+aw*bw;if(cosom<0){cosom=-cosom;bx=-bx;by=-by;bz=-bz;bw=-bw}if(1-cosom>1e-6){omega=Math.acos(cosom);sinom=Math.sin(omega);scale0=Math.sin((1-t)*omega)/sinom;scale1=Math.sin(t*omega)/sinom}else{scale0=1-t;scale1=t}this.x=scale0*ax+scale1*bx;this.y=scale0*ay+scale1*by;this.z=scale0*az+scale1*bz;this.w=scale0*aw+scale1*bw;return this};quat.invert=function(){var a0=this.x,a1=this.y,a2=this.z,a3=this.w,dot=a0*a0+a1*a1+a2*a2+a3*a3,invDot=dot?1/dot:0;this.x=-a0*invDot;this.y=-a1*invDot;this.z=-a2*invDot;this.w=a3*invDot;return this};quat.conjugate=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this};quat.rotateX=function(rad){rad*=.5;var ax=this.x,ay=this.y,az=this.z,aw=this.w,bx=Math.sin(rad),bw=Math.cos(rad);this.x=ax*bw+aw*bx;this.y=ay*bw+az*bx;this.z=az*bw-ay*bx;this.w=aw*bw-ax*bx;return this};quat.rotateY=function(rad){rad*=.5;var ax=this.x,ay=this.y,az=this.z,aw=this.w,by=Math.sin(rad),bw=Math.cos(rad);this.x=ax*bw-az*by;this.y=ay*bw+aw*by;this.z=az*bw+ax*by;this.w=aw*bw-ay*by;return this};quat.rotateZ=function(rad){rad*=.5;var ax=this.x,ay=this.y,az=this.z,aw=this.w,bz=Math.sin(rad),bw=Math.cos(rad);this.x=ax*bw+ay*bz;this.y=ay*bw-ax*bz;this.z=az*bw+aw*bz;this.w=aw*bw-az*bz;return this};quat.calculateW=function(){var x=this.x,y=this.y,z=this.z;this.x=x;this.y=y;this.z=z;this.w=-Math.sqrt(Math.abs(1-x*x-y*y-z*z));return this};quat.fromMat3=function(mat){var m=mat.val,fTrace=m[0]+m[4]+m[8];var fRoot;if(fTrace>0){fRoot=Math.sqrt(fTrace+1);this.w=.5*fRoot;fRoot=.5/fRoot;this.x=(m[7]-m[5])*fRoot;this.y=(m[2]-m[6])*fRoot;this.z=(m[3]-m[1])*fRoot}else{var i=0;if(m[4]>m[0])i=1;if(m[8]>m[i*3+i])i=2;var j=s_iNext[i];var k=s_iNext[j];fRoot=Math.sqrt(m[i*3+i]-m[j*3+j]-m[k*3+k]+1);tmp[i]=.5*fRoot;fRoot=.5/fRoot;tmp[j]=(m[j*3+i]+m[i*3+j])*fRoot;tmp[k]=(m[k*3+i]+m[i*3+k])*fRoot;this.x=tmp[0];this.y=tmp[1];this.z=tmp[2];this.w=(m[k*3+j]-m[j*3+k])*fRoot}return this};quat.idt=quat.identity;quat.sub=quat.subtract;quat.mul=quat.multiply;quat.len=quat.length;quat.lenSq=quat.lengthSq;quat.reset=quat.idt;quat.toString=function(){return"Quaternion("+this.x+", "+this.y+", "+this.z+", "+this.w+")"};quat.str=quat.toString;module.exports=Quaternion},{"./Matrix3":26,"./Vector3":30,"./common":32}],29:[function(require,module,exports){function Vector2(x,y){if(typeof x==="object"){this.x=x.x||0;this.y=x.y||0}else{this.x=x||0;this.y=y||0}}var vec2=Vector2.prototype;vec2.clone=function(){return new Vector2(this.x,this.y)};vec2.copy=function(otherVec){this.x=otherVec.x||0;this.y=otherVec.y||0;return this};vec2.set=function(x,y){if(typeof x==="object"){this.x=x.x||0;this.y=x.y||0}else{this.x=x||0;this.y=y||0}return this};vec2.add=function(v){this.x+=v.x;this.y+=v.y;return this};vec2.subtract=function(v){this.x-=v.x;this.y-=v.y;return this};vec2.multiply=function(v){this.x*=v.x;this.y*=v.y;return this};vec2.scale=function(s){this.x*=s;this.y*=s;return this};vec2.divide=function(v){this.x/=v.x;this.y/=v.y;return this};vec2.negate=function(){this.x=-this.x;this.y=-this.y;return this};vec2.distance=function(v){var dx=v.x-this.x,dy=v.y-this.y;return Math.sqrt(dx*dx+dy*dy)};vec2.distanceSq=function(v){var dx=v.x-this.x,dy=v.y-this.y;return dx*dx+dy*dy};vec2.length=function(){var x=this.x,y=this.y;return Math.sqrt(x*x+y*y)};vec2.lengthSq=function(){var x=this.x,y=this.y;return x*x+y*y};vec2.normalize=function(){var x=this.x,y=this.y;var len=x*x+y*y;if(len>0){len=1/Math.sqrt(len);this.x=x*len;this.y=y*len}return this};vec2.dot=function(v){return this.x*v.x+this.y*v.y};vec2.cross=function(v){return this.x*v.y-this.y*v.x};vec2.lerp=function(v,t){var ax=this.x,ay=this.y;t=t||0;this.x=ax+t*(v.x-ax);this.y=ay+t*(v.y-ay);return this};vec2.transformMat3=function(mat){var x=this.x,y=this.y,m=mat.val;this.x=m[0]*x+m[2]*y+m[4];this.y=m[1]*x+m[3]*y+m[5];return this};vec2.transformMat4=function(mat){var x=this.x,y=this.y,m=mat.val;this.x=m[0]*x+m[4]*y+m[12];this.y=m[1]*x+m[5]*y+m[13];return this};vec2.reset=function(){this.x=0;this.y=0;return this};vec2.sub=vec2.subtract;vec2.mul=vec2.multiply;vec2.div=vec2.divide;vec2.dist=vec2.distance;vec2.distSq=vec2.distanceSq;vec2.len=vec2.length;vec2.lenSq=vec2.lengthSq;vec2.toString=function(){return"Vector2("+this.x+", "+this.y+")"};vec2.random=function(scale){scale=scale||1;var r=Math.random()*2*Math.PI;this.x=Math.cos(r)*scale;this.y=Math.sin(r)*scale;return this};vec2.str=vec2.toString;module.exports=Vector2},{}],30:[function(require,module,exports){function Vector3(x,y,z){if(typeof x==="object"){this.x=x.x||0;this.y=x.y||0;this.z=x.z||0}else{this.x=x||0;this.y=y||0;this.z=z||0}}var vec3=Vector3.prototype;vec3.clone=function(){return new Vector3(this.x,this.y,this.z)};vec3.copy=function(otherVec){this.x=otherVec.x;this.y=otherVec.y;this.z=otherVec.z;return this};vec3.set=function(x,y,z){if(typeof x==="object"){this.x=x.x||0;this.y=x.y||0;this.z=x.z||0}else{this.x=x||0;this.y=y||0;this.z=z||0}return this};vec3.add=function(v){this.x+=v.x;this.y+=v.y;this.z+=v.z;return this};vec3.subtract=function(v){this.x-=v.x;this.y-=v.y;this.z-=v.z;return this};vec3.multiply=function(v){this.x*=v.x;this.y*=v.y;this.z*=v.z;return this};vec3.scale=function(s){this.x*=s;this.y*=s;this.z*=s;return this};vec3.divide=function(v){this.x/=v.x;this.y/=v.y;this.z/=v.z;return this};vec3.negate=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;return this};vec3.distance=function(v){var dx=v.x-this.x,dy=v.y-this.y,dz=v.z-this.z;return Math.sqrt(dx*dx+dy*dy+dz*dz)};vec3.distanceSq=function(v){var dx=v.x-this.x,dy=v.y-this.y,dz=v.z-this.z;return dx*dx+dy*dy+dz*dz};vec3.length=function(){var x=this.x,y=this.y,z=this.z;return Math.sqrt(x*x+y*y+z*z)};vec3.lengthSq=function(){var x=this.x,y=this.y,z=this.z;return x*x+y*y+z*z};vec3.normalize=function(){var x=this.x,y=this.y,z=this.z;var len=x*x+y*y+z*z;if(len>0){len=1/Math.sqrt(len);this.x=x*len;this.y=y*len;this.z=z*len}return this};vec3.dot=function(v){return this.x*v.x+this.y*v.y+this.z*v.z};vec3.cross=function(v){var ax=this.x,ay=this.y,az=this.z,bx=v.x,by=v.y,bz=v.z;this.x=ay*bz-az*by;this.y=az*bx-ax*bz;this.z=ax*by-ay*bx;return this};vec3.lerp=function(v,t){var ax=this.x,ay=this.y,az=this.z;t=t||0;this.x=ax+t*(v.x-ax);this.y=ay+t*(v.y-ay);this.z=az+t*(v.z-az);return this};vec3.transformMat4=function(mat){var x=this.x,y=this.y,z=this.z,m=mat.val;this.x=m[0]*x+m[4]*y+m[8]*z+m[12];this.y=m[1]*x+m[5]*y+m[9]*z+m[13];this.z=m[2]*x+m[6]*y+m[10]*z+m[14];return this};vec3.transformMat3=function(mat){var x=this.x,y=this.y,z=this.z,m=mat.val;this.x=x*m[0]+y*m[3]+z*m[6];this.y=x*m[1]+y*m[4]+z*m[7];this.z=x*m[2]+y*m[5]+z*m[8];return this};vec3.transformQuat=function(q){var x=this.x,y=this.y,z=this.z,qx=q.x,qy=q.y,qz=q.z,qw=q.w,ix=qw*x+qy*z-qz*y,iy=qw*y+qz*x-qx*z,iz=qw*z+qx*y-qy*x,iw=-qx*x-qy*y-qz*z;this.x=ix*qw+iw*-qx+iy*-qz-iz*-qy;this.y=iy*qw+iw*-qy+iz*-qx-ix*-qz;this.z=iz*qw+iw*-qz+ix*-qy-iy*-qx;return this};vec3.project=function(mat){var x=this.x,y=this.y,z=this.z,m=mat.val,a00=m[0],a01=m[1],a02=m[2],a03=m[3],a10=m[4],a11=m[5],a12=m[6],a13=m[7],a20=m[8],a21=m[9],a22=m[10],a23=m[11],a30=m[12],a31=m[13],a32=m[14],a33=m[15];var l_w=1/(x*a03+y*a13+z*a23+a33);this.x=(x*a00+y*a10+z*a20+a30)*l_w;this.y=(x*a01+y*a11+z*a21+a31)*l_w;this.z=(x*a02+y*a12+z*a22+a32)*l_w;return this};vec3.unproject=function(viewport,invProjectionView){var viewX=viewport.x,viewY=viewport.y,viewWidth=viewport.z,viewHeight=viewport.w;var x=this.x,y=this.y,z=this.z;x=x-viewX;y=viewHeight-y-1;y=y-viewY;this.x=2*x/viewWidth-1;this.y=2*y/viewHeight-1;this.z=2*z-1;return this.project(invProjectionView)};vec3.random=function(scale){scale=scale||1;var r=Math.random()*2*Math.PI;var z=Math.random()*2-1;var zScale=Math.sqrt(1-z*z)*scale;this.x=Math.cos(r)*zScale;this.y=Math.sin(r)*zScale;this.z=z*scale;return this};vec3.reset=function(){this.x=0;this.y=0;this.z=0;return this};vec3.sub=vec3.subtract;vec3.mul=vec3.multiply;vec3.div=vec3.divide;vec3.dist=vec3.distance;vec3.distSq=vec3.distanceSq;vec3.len=vec3.length;vec3.lenSq=vec3.lengthSq;vec3.toString=function(){return"Vector3("+this.x+", "+this.y+", "+this.z+")"};vec3.str=vec3.toString;module.exports=Vector3},{}],31:[function(require,module,exports){var common=require("./common");function Vector4(x,y,z,w){if(typeof x==="object"){this.x=x.x||0;this.y=x.y||0;this.z=x.z||0;this.w=x.w||0}else{this.x=x||0;this.y=y||0;this.z=z||0;this.w=w||0}}var vec4=Vector4.prototype;for(var k in common){vec4[k]=common[k]}vec4.clone=function(){return new Vector4(this.x,this.y,this.z,this.w)};vec4.multiply=function(v){this.x*=v.x;this.y*=v.y;this.z*=v.z;this.w*=v.w;return this};vec4.divide=function(v){this.x/=v.x;this.y/=v.y;this.z/=v.z;this.w/=v.w;return this};vec4.distance=function(v){var dx=v.x-this.x,dy=v.y-this.y,dz=v.z-this.z,dw=v.w-this.w;return Math.sqrt(dx*dx+dy*dy+dz*dz+dw*dw)};vec4.distanceSq=function(v){var dx=v.x-this.x,dy=v.y-this.y,dz=v.z-this.z,dw=v.w-this.w;return dx*dx+dy*dy+dz*dz+dw*dw};vec4.negate=function(){this.x=-this.x;this.y=-this.y;this.z=-this.z;this.w=-this.w;return this};vec4.transformMat4=function(mat){var m=mat.val,x=this.x,y=this.y,z=this.z,w=this.w;this.x=m[0]*x+m[4]*y+m[8]*z+m[12]*w;this.y=m[1]*x+m[5]*y+m[9]*z+m[13]*w;this.z=m[2]*x+m[6]*y+m[10]*z+m[14]*w;this.w=m[3]*x+m[7]*y+m[11]*z+m[15]*w;return this};vec4.transformQuat=function(q){var x=this.x,y=this.y,z=this.z,qx=q.x,qy=q.y,qz=q.z,qw=q.w,ix=qw*x+qy*z-qz*y,iy=qw*y+qz*x-qx*z,iz=qw*z+qx*y-qy*x,iw=-qx*x-qy*y-qz*z;this.x=ix*qw+iw*-qx+iy*-qz-iz*-qy;this.y=iy*qw+iw*-qy+iz*-qx-ix*-qz;this.z=iz*qw+iw*-qz+ix*-qy-iy*-qx;return out};vec4.random=function(scale){scale=scale||1;this.x=(Math.random()*2-1)*scale;this.y=(Math.random()*2-1)*scale;this.z=(Math.random()*2-1)*scale;this.w=(Math.random()*2-1)*scale;return this};vec4.reset=function(){this.x=0;this.y=0;this.z=0;this.w=0;return this};vec4.sub=vec4.subtract;vec4.mul=vec4.multiply;vec4.div=vec4.divide;vec4.dist=vec4.distance;vec4.distSq=vec4.distanceSq;vec4.len=vec4.length;vec4.lenSq=vec4.lengthSq;vec4.toString=function(){return"Vector4("+this.x+", "+this.y+", "+this.z+", "+this.w+")"};vec4.str=vec4.toString;module.exports=Vector4},{"./common":32}],32:[function(require,module,exports){module.exports={copy:function(otherVec){this.x=otherVec.x||0;this.y=otherVec.y||0;this.z=otherVec.z||0;this.w=otherVec.w||0;return this},set:function(x,y,z,w){if(typeof x==="object"){this.x=x.x||0;this.y=x.y||0;this.z=x.z||0;this.w=x.w||0}else{this.x=x||0;this.y=y||0;this.z=z||0;this.w=w||0}return this},add:function(v){this.x+=v.x;this.y+=v.y;this.z+=v.z;this.w+=v.w;return this},subtract:function(v){this.x-=v.x;this.y-=v.y;this.z-=v.z;this.w-=v.w;return this},scale:function(s){this.x*=s;this.y*=s;this.z*=s;this.w*=s;return this},length:function(){var x=this.x,y=this.y,z=this.z,w=this.w;return Math.sqrt(x*x+y*y+z*z+w*w)},lengthSq:function(){var x=this.x,y=this.y,z=this.z,w=this.w;return x*x+y*y+z*z+w*w},normalize:function(){var x=this.x,y=this.y,z=this.z,w=this.w;var len=x*x+y*y+z*z+w*w;if(len>0){len=1/Math.sqrt(len);this.x=x*len;this.y=y*len;this.z=z*len;this.w=w*len}return this},dot:function(v){return this.x*v.x+this.y*v.y+this.z*v.z+this.w*v.w},lerp:function(v,t){var ax=this.x,ay=this.y,az=this.z,aw=this.w;t=t||0;this.x=ax+t*(v.x-ax);this.y=ay+t*(v.y-ay);this.z=az+t*(v.z-az);this.w=aw+t*(v.w-aw);return this}}},{}],33:[function(require,module,exports){module.exports={Vector2:require("./Vector2"),Vector3:require("./Vector3"),Vector4:require("./Vector4"),Matrix3:require("./Matrix3"),Matrix4:require("./Matrix4"),Quaternion:require("./Quaternion")}},{"./Matrix3":26,"./Matrix4":27,"./Quaternion":28,"./Vector2":29,"./Vector3":30,"./Vector4":31}]},{},[7])(7)});